<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>MySale ‚Äî –≤–∏—Ç—Ä–∏–Ω–∞ (–∞–¥–º–∏–Ω–∫–∞ –≤–Ω—É—Ç—Ä–∏)</title>
<style>
:root{
  --bg:#fae7c9;
  --panel:#fff5e7;
  --brand:#f28b1a;
  --ink:#2b2b2b;
  --muted:#666;
  --card:#fff8ee;
  --radius:18px;
  --shadow:0 8px 30px rgba(0,0,0,.08);
}
*{box-sizing:border-box}
html,body{margin:0;height:100%;background:var(--bg);color:var(--ink);font:16px/1.55 "Inter",system-ui,-apple-system,Segoe UI,Roboto,Arial}
a{color:var(--brand);text-decoration:none}
.container{max-width:1100px;margin:0 auto;padding:32px 20px 48px}
.header{display:flex;align-items:center;gap:24px;margin-bottom:18px}
.logo{display:flex;align-items:center;gap:10px;user-select:none}
.logo img{height:40px;width:auto}
.logo-text{font-weight:800;font-size:38px;color:var(--brand);letter-spacing:.5px}
.badge{display:inline-flex;align-items:center;justify-content:center;background:var(--brand);color:#fff;border-radius:10px 10px 10px 0;padding:6px 8px;font-weight:700}
.topbar{display:flex;align-items:center;gap:12px;justify-content:space-between;margin:10px 0 20px}
.nav{display:flex;gap:18px;font-weight:600}
.nav a{color:#403b35;opacity:.9}
.tools{display:flex;gap:8px}
.btn{border:0;border-radius:12px;background:var(--brand);color:#fff;padding:10px 14px;font-weight:700;box-shadow:var(--shadow);cursor:pointer}
.btn.secondary{background:#fff;color:#333}
.btn.ghost{background:transparent;color:var(--brand);box-shadow:none;border:2px solid var(--brand)}
.btn.small{padding:8px 10px;border-radius:10px;font-size:13px}
.search{display:flex;gap:10px;background:var(--panel);border-radius:20px;padding:14px 14px;box-shadow:var(--shadow)}
.search input{flex:1;border:0;background:#fff;border-radius:14px;padding:12px 14px;font-size:16px;outline:none}
.grid{display:grid;gap:16px;margin-top:24px}
.card{background:var(--card);border-radius:18px;padding:18px 16px;box-shadow:var(--shadow);transition:.2s;display:flex;align-items:center;gap:14px}
.card:hover{transform:translateY(-3px)}
.iconbox{height:52px;width:52px;border-radius:14px;background:#ffe3c3;display:flex;align-items:center;justify-content:center;flex-shrink:0;overflow:hidden}
.iconbox svg{height:28px;width:28px;fill:#f07d00}
.iconbox img{height:100%;width:100%;object-fit:cover}
.card .title{font-weight:800}
.card .hint{font-size:13px;color:var(--muted)}
.footer{margin-top:36px;color:#777;font-size:13px;display:flex;gap:16px;flex-wrap:wrap}

/* editor */
#editorBar{position:fixed;right:18px;bottom:18px;display:flex;gap:10px;z-index:50}
#panel{position:fixed;right:18px;top:18px;width:340px;background:#fff;border-radius:16px;box-shadow:var(--shadow);padding:16px 14px 14px 14px;display:none;z-index:60;max-height:88vh;overflow:auto}
#panel h3{margin:6px 0 10px}
.row{display:flex;gap:8px}
.input, select, textarea{width:100%;padding:10px 12px;border-radius:10px;border:1px solid #e4d7c7;background:#fff}
label{font-size:12px;color:#6b5c4e;margin:6px 0 4px;display:block}
.help{font-size:12px;color:#8a7b6b}
.list{display:flex;flex-direction:column;gap:10px;margin-top:10px}
.item{border:1px dashed #e6d7c3;padding:10px;border-radius:12px;background:#fff8f0}
.item.drag{opacity:.5}
.item-header{display:flex;align-items:center;gap:8px;justify-content:space-between}
.item-actions{display:flex;gap:8px}
.item-actions .btn.small{padding:4px 8px}
hr{border:0;border-top:1px solid #efe0d0;margin:12px 0}
.logo-uploader{display:flex;align-items:center;gap:10px}
.logo-uploader .preview{height:36px;width:auto}
.toggle{position:fixed;left:18px;bottom:18px;z-index:50}
.hidden{display:none}
.kbd{font-family:ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas,"Liberation Mono","Courier New",monospace;background:#f6efe6;border-radius:6px;padding:2px 6px}
</style>
</head>
<body>
<div class="container" id="app">
  <div class="header">
    <div class="logo" id="logoNode">
      <img id="logoImg" class="hidden" alt="logo"/>
      <div id="logoText" class="logo-text">mysale</div>
      <div class="badge">‚úì</div>
    </div>
    <div class="topbar" style="flex:1">
      <nav class="nav">
        <a href="#" onclick="return false">Home</a>
        <a href="#" onclick="return false">About</a>
        <a href="#" onclick="return false">Contact</a>
      </nav>
      <div class="tools">
        <button class="btn small" id="editBtn">‚úèÔ∏è –ò–∑–º–µ–Ω–∏—Ç—å</button>
        <button class="btn small secondary" id="exportBtn">‚¨áÔ∏è –≠–∫—Å–ø–æ—Ä—Ç</button>
        <label class="btn small ghost" for="importFile">‚¨ÜÔ∏è –ò–º–ø–æ—Ä—Ç</label>
        <input id="importFile" type="file" accept="application/json" class="hidden" />
      </div>
    </div>
  </div>

  <div class="search">
    <input id="q" placeholder="–ü–æ–∏—Å–∫ —Ç–æ–≤–∞—Ä–æ–≤, —É—Å–ª—É–≥ –∏ –æ–±—ä—è–≤–ª–µ–Ω–∏–π‚Ä¶" />
    <button class="btn" id="searchBtn">–ü–æ–∏—Å–∫</button>
  </div>

  <div id="grid" class="grid"></div>

  <div class="footer">
    <a href="#" onclick="return false">–ü—Ä–∞–≤–∏–ª–∞</a>
    <a href="#" onclick="return false">–ö–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ—Å—Ç—å</a>
    <a href="#" onclick="return false">–û–±—Ä–∞—Ç–Ω–∞—è —Å–≤—è–∑—å</a>
  </div>
</div>

<!-- floating editor buttons -->
<div id="editorBar" class="hidden">
  <button class="btn small" id="addCard">+ –ö–∞—Ä—Ç–æ—á–∫–∞</button>
  <button class="btn small" id="saveBtn">üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
  <button class="btn small ghost" id="closeBtn">‚úñ –ó–∞–∫—Ä—ã—Ç—å</button>
</div>

<!-- side panel -->
<aside id="panel">
  <h3>–®–∞–ø–∫–∞</h3>
  <label>–¢–µ–∫—Å—Ç –ª–æ–≥–æ—Ç–∏–ø–∞</label>
  <input id="logoTextInput" class="input" placeholder="mysale"/>
  <label>–¶–≤–µ—Ç –ª–æ–≥–æ—Ç–∏–ø–∞</label>
  <input id="logoColor" type="color" value="#f28b1a" class="input"/>
  <div class="logo-uploader">
    <label class="btn small ghost">
      –ó–∞–≥—Ä—É–∑–∏—Ç—å –ª–æ–≥–æ—Ç–∏–ø
      <input id="logoUpload" type="file" accept="image/*" class="hidden"/>
    </label>
    <img id="logoPreview" class="preview hidden"/>
    <button id="logoAsText" class="btn small secondary">–¢–µ–∫—Å—Ç –≤–º–µ—Å—Ç–æ –∫–∞—Ä—Ç–∏–Ω–∫–∏</button>
  </div>
  <hr/>
  <h3>–°–µ—Ç–∫–∞</h3>
  <div class="row">
    <div style="flex:1">
      <label>–ö–æ–ª–æ–Ω–æ–∫ (2‚Äì6)</label>
      <input id="cols" type="number" min="2" max="6" class="input" />
    </div>
    <div style="flex:1">
      <label>–†–∞–¥–∏—É—Å</label>
      <input id="radius" type="number" min="6" max="28" class="input"/>
    </div>
  </div>
  <label>–û—Å–Ω–æ–≤–Ω–æ–π —Ü–≤–µ—Ç</label>
  <input id="brandColor" type="color" value="#f28b1a" class="input"/>
  <p class="help">–ü–µ—Ä–µ—Ç–∞—Å–∫–∏–≤–∞–π—Ç–µ –∫–∞—Ä—Ç–æ—á–∫–∏ –º—ã—à—å—é –¥–ª—è –∏–∑–º–µ–Ω–µ–Ω–∏—è –ø–æ—Ä—è–¥–∫–∞.</p>
  <hr/>
  <h3>–ö–∞—Ä—Ç–æ—á–∫–∏</h3>
  <div id="cardsList" class="list"></div>
</aside>

<script>
const LS_KEY = "mysale_vitrine_v1";
const $ = sel => document.querySelector(sel);
const $$ = sel => Array.from(document.querySelectorAll(sel));

// --- initial model (defaults) ---
const defaults = {
  logoText: "mysale",
  logoColor: "#f28b1a",
  logoDataUrl: "",
  columns: 4,
  radius: 18,
  brand: "#f28b1a",
  items: [
    {id: uid(), title:"–ù–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç—å", hint:"–ö–≤–∞—Ä—Ç–∏—Ä—ã, –¥–æ–º–∞, —É—á–∞—Å—Ç–∫–∏", icon:"home", iconBg:"#ffe3c3", url:"#realestate"},
    {id: uid(), title:"–ê–≤—Ç–æ",          hint:"–õ–µ–≥–∫–æ–≤—ã–µ –∏ –≥—Ä—É–∑–æ–≤—ã–µ",  icon:"car",  iconBg:"#ffe3c3", url:"#cars"},
    {id: uid(), title:"–≠–ª–µ–∫—Ç—Ä–æ–Ω–∏–∫–∞",   hint:"–¢–µ–ª–µ–≤–∏–∑–æ—Ä—ã –∏ –Ω–æ—É—Ç–±—É–∫–∏",icon:"tv",   iconBg:"#ffe3c3", url:"#electronics"},
    {id: uid(), title:"–í–∞–∫–∞–Ω—Å–∏–∏",      hint:"–†–∞–±–æ—Ç–∞ —Ä—è–¥–æ–º",         icon:"brief",iconBg:"#ffe3c3", url:"#jobs"},
    {id: uid(), title:"–°–µ—Ä–≤–∏—Å—ã",       hint:"–ú–∞—Å—Ç–µ—Ä–∞ –∏ —É—Å–ª—É–≥–∏",     icon:"wrench",iconBg:"#ffe3c3",url:"#services"},
    {id: uid(), title:"–ú–µ–±–µ–ª—å",        hint:"–î–æ–º –∏ –∏–Ω—Ç–µ—Ä—å–µ—Ä",       icon:"sofa", iconBg:"#ffe3c3", url:"#furniture"},
    {id: uid(), title:"–û–¥–µ–∂–¥–∞",        hint:"–ú–æ–¥–∞ –∏ —Å—Ç–∏–ª—å",         icon:"shirt",iconBg:"#ffe3c3", url:"#fashion"},
    {id: uid(), title:"–•–æ–±–±–∏",         hint:"–°–ø–æ—Ä—Ç –∏ –æ—Ç–¥—ã—Ö",        icon:"bike", iconBg:"#ffe3c3", url:"#hobbies"}
  ]
};

let model = loadModel();

// --- utils ---
function uid(){ return Math.random().toString(36).slice(2,9) }
function save(){ localStorage.setItem(LS_KEY, JSON.stringify(model)) }
function loadModel(){
  try{ return JSON.parse(localStorage.getItem(LS_KEY)) || structuredClone(defaults) }catch(e){ return structuredClone(defaults) }
}
function el(tag, attrs={}, ...kids){
  const n = document.createElement(tag);
  for(const [k,v] of Object.entries(attrs)){
    if(k==="class") n.className = v;
    else if(k.startsWith("on")) n.addEventListener(k.slice(2), v);
    else if(k==="html") n.innerHTML = v;
    else n.setAttribute(k,v);
  }
  for(const k of kids) if(k) n.append(k);
  return n;
}

// --- icons (inline SVG) ---
const icons = {
  home:`<svg viewBox="0 0 24 24"><path d="M12 3l9 8-1.5 1.5L18 10.5V20h-5v-5H11v5H6v-9.5L4.5 12.5 3 11z"/></svg>`,
  car:`<svg viewBox="0 0 24 24"><path d="M5 11l1-3 3-2h6l3 2 1 3v5h-2v2h-2v-2H9v2H7v-2H5v-5zm2.5 1a1.5 1.5 0 100 3 1.5 1.5 0 000-3zm9 0a1.5 1.5 0 100 3 1.5 1.5 0 000-3z"/></svg>`,
  tv:`<svg viewBox="0 0 24 24"><path d="M4 6h16v10H4zM8 18h8v2H8z"/></svg>`,
  brief:`<svg viewBox="0 0 24 24"><path d="M9 3h6v3h4v14H5V6h4V3zm2 3h2V5h-2v1z"/></svg>`,
  wrench:`<svg viewBox="0 0 24 24"><path d="M14.7 6.3a4 4 0 11-5.4 5.4l-5.3 5.3 1.4 1.4 5.3-5.3a4 4 0 005.4-5.4l-1.4-1.4z"/></svg>`,
  sofa:`<svg viewBox="0 0 24 24"><path d="M4 10h16v6h-2v2H6v-2H4v-6zM7 6h10v3H7z"/></svg>`,
  shirt:`<svg viewBox="0 0 24 24"><path d="M9 4l3 2 3-2 3 3-3 2v11H8V9L5 7l3-3z"/></svg>`,
  bike:`<svg viewBox="0 0 24 24"><path d="M7 17a3 3 0 110-6 3 3 0 010 6zm10 0a3 3 0 110-6 3 3 0 010 6zM11 7h3l3 5h-2l-1-2h-2l-1 2H9l2-5z"/></svg>`
};

// --- rendering ---
function render(){
  // brand colors / radius
  document.documentElement.style.setProperty('--brand', model.brand || '#f28b1a');
  document.documentElement.style.setProperty('--radius', (model.radius||18)+'px');

  // logo
  $('#logoText').textContent = model.logoText || 'mysale';
  $('#logoText').style.color = model.logoColor || '#f28b1a';
  if(model.logoDataUrl){
    $('#logoImg').src = model.logoDataUrl; $('#logoImg').classList.remove('hidden');
    $('#logoText').classList.add('hidden'); $('#logoPreview').src = model.logoDataUrl; $('#logoPreview').classList.remove('hidden');
  }else{
    $('#logoImg').classList.add('hidden'); $('#logoText').classList.remove('hidden');
    $('#logoPreview').classList.add('hidden');
  }

  // grid
  const cols = Math.min(6, Math.max(2, Number(model.columns||4)));
  $('#grid').style.gridTemplateColumns = `repeat(${cols}, minmax(0,1fr))`;

  // cards
  const q = ($('#q').value||"").trim().toLowerCase();
  const grid = $('#grid'); grid.innerHTML = '';
  model.items
    .filter(it => !q || it.title.toLowerCase().includes(q) || (it.hint||'').toLowerCase().includes(q))
    .forEach(it => grid.append(cardNode(it)));

  // panel values (if opened)
  $('#logoTextInput').value = model.logoText;
  $('#logoColor').value = model.logoColor || '#f28b1a';
  $('#brandColor').value = model.brand || '#f28b1a';
  $('#cols').value = cols;
  $('#radius').value = model.radius || 18;

  if(panelOpened) buildCardsList();
}

function iconNode(it){
  const box = el('div', {class:'iconbox', style:`background:${it.iconBg||'#ffe3c3'}`});
  if(/^data:image|^https?:/.test(it.icon||'')){
    box.append(el('img',{src:it.icon}));
  }else if(icons[it.icon]){
    box.innerHTML = icons[it.icon];
  }else{
    box.append(el('div',{style:'font-size:28px'}, it.icon||'üß©'));
  }
  return box;
}

function cardNode(it){
  const a = el('a',{href: it.url || '#', target:'_blank', class:'card', draggable: panelOpened ? true : false});
  a.append(iconNode(it));
  a.append(el('div',{},
      el('div',{class:'title'}, it.title||'–ë–µ–∑ –Ω–∞–∑–≤–∞–Ω–∏—è'),
      el('div',{class:'hint'}, it.hint||'')
  ));
  if(panelOpened){
    a.addEventListener('dragstart', e=>{ e.dataTransfer.setData('text/plain', it.id); a.classList.add('drag') });
    a.addEventListener('dragend', ()=> a.classList.remove('drag'));
    a.addEventListener('dragover', e=> e.preventDefault());
    a.addEventListener('drop', e=>{
      e.preventDefault();
      const from = e.dataTransfer.getData('text/plain');
      const to = it.id;
      reorder(from,to);
    });
    a.addEventListener('click', (e)=>{ e.preventDefault(); scrollToItemForm(it.id) });
  }
  return a;
}

function reorder(fromId, toId){
  if(fromId===toId) return;
  const i = model.items.findIndex(x=>x.id===fromId);
  const j = model.items.findIndex(x=>x.id===toId);
  const [m] = model.items.splice(i,1);
  model.items.splice(j,0,m);
  save(); render();
}

// --- editor panel ---
let panelOpened = false;
$('#editBtn').addEventListener('click', ()=>{ openPanel(true) });
$('#closeBtn').addEventListener('click', ()=>{ openPanel(false) });
$('#saveBtn').addEventListener('click', ()=>{ save(); openPanel(false); });

function openPanel(flag){
  panelOpened = !!flag;
  $('#panel').style.display = flag?'block':'none';
  $('#editorBar').classList.toggle('hidden', !flag);
  $('#addCard').classList.toggle('hidden', !flag);
  render();
}

function buildCardsList(){
  const list = $('#cardsList'); list.innerHTML = '';
  for(const it of model.items){
    const card = el('div',{class:'item', id:'i_'+it.id});
    const header = el('div',{class:'item-header'},
      el('strong',{}, it.title || '–ë–µ–∑ –Ω–∞–∑–≤–∞–Ω–∏—è'),
      el('div',{class:'item-actions'},
        el('button',{class:'btn small secondary', onclick:()=>dupItem(it.id)},'–î—É–±–ª–∏—Ä–æ–≤–∞—Ç—å'),
        el('button',{class:'btn small ghost', onclick:()=>delItem(it.id)},'–£–¥–∞–ª–∏—Ç—å')
      ));
    card.append(header);

    card.append(lab('–ó–∞–≥–æ–ª–æ–≤–æ–∫'), inp(it,'title'));
    card.append(lab('–ü–æ–¥–ø–∏—Å—å'), inp(it,'hint'));
    card.append(lab('–°—Å—ã–ª–∫–∞ (URL)'), inp(it,'url'));
    const row = el('div',{class:'row'},
      el('div',{style:'flex:1'}, lab('–ò–∫–æ–Ω–∫–∞ (—ç–º–æ–¥–∑–∏/–∫–ª—é—á SVG/URL)'), inp(it,'icon')),
      el('div',{style:'flex:1'}, lab('–¶–≤–µ—Ç —Ñ–æ–Ω–∞ –∏–∫–æ–Ω–∫–∏'), color(it,'iconBg'))
    );
    card.append(row);
    list.append(card);

    function lab(t){ return el('label',{}, t) }
    function inp(obj, key){
      const n = el('input',{class:'input', value: obj[key]||'', oninput:(e)=>{ obj[key]=e.target.value; save(); render(); }});
      return n;
    }
    function color(obj,key){
      const val = obj[key] || '#ffe3c3';
      const n = el('input',{type:'color', class:'input', value: val, oninput:(e)=>{ obj[key]=e.target.value; save(); render(); }});
      return n;
    }
  }
}

function scrollToItemForm(id){
  const node = $('#i_'+id);
  if(node){ openPanel(true); node.scrollIntoView({behavior:'smooth', block:'center'}); node.style.outline='2px solid var(--brand)'; setTimeout(()=>node.style.outline='none',1200); }
}

function delItem(id){
  if(!confirm('–£–¥–∞–ª–∏—Ç—å –∫–∞—Ä—Ç–æ—á–∫—É?')) return;
  model.items = model.items.filter(x=>x.id!==id);
  save(); buildCardsList(); render();
}
function dupItem(id){
  const src = model.items.find(x=>x.id===id);
  const copy = JSON.parse(JSON.stringify(src)); copy.id=uid(); copy.title += ' (–∫–æ–ø–∏—è)';
  model.items.splice(model.items.findIndex(x=>x.id===id)+1,0,copy);
  save(); buildCardsList(); render();
}
$('#addCard').addEventListener('click', ()=>{
  model.items.push({id:uid(), title:'–ù–æ–≤–∞—è –∫–∞—Ä—Ç–æ—á–∫–∞', hint:'–û–ø–∏—Å–∞–Ω–∏–µ', icon:'home', iconBg:'#ffe3c3', url:'#'});
  save(); buildCardsList(); render();
});

// bindings
$('#q').addEventListener('input', render);
$('#searchBtn').addEventListener('click', render);
$('#cols').addEventListener('input', e=>{ model.columns = Number(e.target.value||4); save(); render(); });
$('#radius').addEventListener('input', e=>{ model.radius = Number(e.target.value||18); save(); render(); });
$('#brandColor').addEventListener('input', e=>{ model.brand = e.target.value; save(); render(); });
$('#logoTextInput').addEventListener('input', e=>{ model.logoText = e.target.value; model.logoDataUrl=""; save(); render(); });
$('#logoColor').addEventListener('input', e=>{ model.logoColor = e.target.value; save(); render(); });
$('#logoAsText').addEventListener('click', ()=>{ model.logoDataUrl=""; save(); render(); });

$('#logoUpload').addEventListener('change', async (ev)=>{
  const file = ev.target.files?.[0];
  if(!file) return;
  const buf = await file.arrayBuffer();
  const base64 = btoa(String.fromCharCode(...new Uint8Array(buf)));
  const dataUrl = `data:${file.type};base64,${base64}`;
  model.logoDataUrl = dataUrl;
  save(); render();
});

// import / export
$('#exportBtn').addEventListener('click', ()=>{
  const blob = new Blob([JSON.stringify(model, null, 2)], {type:'application/json'});
  const a = document.createElement('a');
  a.href = URL.createObjectURL(blob);
  a.download = 'mysale_vitrine_config.json';
  a.click();
});
$('#importFile').addEventListener('change', async (e)=>{
  const file = e.target.files?.[0];
  if(!file) return;
  const txt = await file.text();
  try{
    const cfg = JSON.parse(txt);
    if(!cfg.items) throw 0;
    model = Object.assign(structuredClone(defaults), cfg);
    save(); render();
  }catch(err){
    alert('–ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π JSON');
  }
});

// init
render();

</script>
</body>
</html>
