<!doctype html>
<html lang="ru">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>MySale ‚Äî –í–∏—Ç—Ä–∏–Ω–∞ (–ê–¥–º–∏–Ω)</title>
<style>
  :root{
    --bg:#F7E6CA;
    --surface:#FFF5E6;
    --accent:#FF7A00;
    --text:#2A2A1A;
    --radius:16px;
    --cols:4;
    --gap:18px;
  }
  *{box-sizing:border-box}
  html,body{height:100%}
  body{
    margin:0;
    font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Arial,Helvetica,sans-serif;
    background:var(--bg);
    color:var(--text);
  }
  .wrap{display:grid;grid-template-columns:320px 1fr;gap:20px;min-height:100%}
  aside{
    background:#fff8ee;
    border-radius:18px;
    padding:18px;
    box-shadow:0 8px 30px rgba(0,0,0,.06);
    margin:14px;
    height:calc(100vh - 28px);
    overflow:auto;
    position:sticky;top:14px
  }
  aside h3{margin:0 0 8px;font-size:16px}
  aside .group{border-top:1px dashed #eadfcf;padding-top:12px;margin-top:12px}
  label{display:block;font-size:12px;margin:12px 0 6px;color:#7a6b57}
  input[type="text"], input[type="number"], input[type="url"], textarea, select{
    width:100%;padding:10px 12px;border-radius:10px;border:1px solid #ebdfce;background:#fff;
    outline:none;box-shadow:0 2px 0 rgba(0,0,0,.02) inset;font-size:14px
  }
  textarea{min-height:90px}
  .row{display:flex;gap:10px;align-items:center}
  .row > *{flex:1}
  .btn{display:inline-flex;align-items:center;gap:8px;border:0;background:var(--accent);color:#fff;padding:9px 14px;border-radius:12px;cursor:pointer;font-weight:600;box-shadow:0 6px 18px rgba(255,122,0,.25)}
  .btn.secondary{background:#fff;color:var(--text);border:1px solid #eadfcf;box-shadow:none}
  .toolbar{display:flex;gap:10px;margin:8px 0 0;flex-wrap:wrap}
  #header{
    display:flex;justify-content:space-between;align-items:center;padding:18px 22px;margin:14px 14px 0;border-radius:18px;
    background:linear-gradient(180deg, var(--surface), #fff7ec);
    box-shadow:0 8px 30px rgba(0,0,0,.05);
    position:sticky;top:0;z-index:2
  }
  .brandBox{display:flex;align-items:center;gap:12px;position:relative}
  #brandName{font-size:42px;font-weight:800;letter-spacing:.5px;display:inline-flex;gap:2px;line-height:1}
  #brandName span{display:inline-block}
  #logo{width:52px;height:52px;object-fit:contain}
  .canvas{
    padding:20px;margin:18px;min-height:calc(100vh - 200px);
  }
  .grid{
    display:grid;grid-template-columns:repeat(var(--cols), minmax(220px,1fr));gap:var(--gap);
    position:relative;
  }
  .card{
    background:var(--surface);border-radius:var(--radius);
    box-shadow:0 15px 30px rgba(0,0,0,.08);
    padding:18px;position:relative;transition:box-shadow .15s, transform .15s;
    user-select:text
  }
  .card:hover{box-shadow:0 18px 40px rgba(0,0,0,.12);transform:translateY(-1px)}
  .card .title{font-weight:800;margin:6px 0;font-size:18px;outline:none}
  .card .hint{font-size:13px;color:#7a6b57;margin:0;outline:none}
  .card .icon{font-size:28px}
  .linkBadge{
    position:absolute;top:10px;right:10px;background:#fff;border:1px solid #eadfcf;border-radius:999px;padding:4px 9px;font-size:12px;color:#7a6b57;cursor:pointer
  }
  .freemove .grid{position:relative}
  .freemove .card,
  .freemove .brandBox{position:absolute;cursor:move}
  .pill{display:inline-flex;gap:6px;background:#fff;border:1px solid #eadfcf;padding:6px 9px;border-radius:999px;font-size:12px;align-items:center}
  .pill input[type="color"]{border:0;padding:0;width:22px;height:22px;background:none}
  .colorRow{display:flex;gap:8px;align-items:center}
  .colorRow input[type="text"]{width:92px}
  .letters{display:flex;flex-wrap:wrap;gap:6px}
  .letters .letter{display:flex;align-items:center;gap:6px;background:#fff;border:1px solid #eadfcf;padding:6px;border-radius:10px}
  .letters .letter b{min-width:10px}
  .ghostTip{font-size:12px;color:#998d7b}
  .status{font-size:12px;color:#6d5c46;margin-left:8px}
</style>
</head>
<body>
<div class="wrap">
  <aside>
    <div class="row" style="align-items:center;gap:10px">
      <img id="logoPreview" src="" alt="logo" style="width:34px;height:34px;object-fit:contain;border-radius:10px;box-shadow:0 4px 10px rgba(0,0,0,.08);background:transparent"/>
      <h2 style="margin:0">MySale ‚Äî –ê–¥–º–∏–Ω</h2>
    </div>

    <div class="toolbar">
      <button class="btn" id="btnSave">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
      <button class="btn secondary" id="btnExport">–≠–∫—Å–ø–æ—Ä—Ç</button>
      <label class="btn secondary" style="cursor:pointer">
        –ò–º–ø–æ—Ä—Ç <input id="fileImport" type="file" accept="application/json" style="display:none">
      </label>
      <span class="status" id="status"></span>
    </div>

    <div class="group">
      <h3>–ë—Ä–µ–Ω–¥</h3>
      <label>–ù–∞–∑–≤–∞–Ω–∏–µ</label>
      <input id="brandInput" type="text" placeholder="MySale" value="MySale"/>
      <div class="row">
        <label class="pill"><input id="perLetter" type="checkbox"> –ü–µ—Ä-–±—É–∫–≤–µ–Ω–Ω—ã–µ —Ü–≤–µ—Ç–∞</label>
        <label class="pill"><input id="freeMove" type="checkbox"> –°–≤–æ–±–æ–¥–Ω–æ–µ –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏–µ</label>
      </div>

      <label>–õ–æ–≥–æ—Ç–∏–ø (PNG/SVG —Å –ø—Ä–æ–∑—Ä–∞—á–Ω–æ—Å—Ç—å—é)</label>
      <input id="fileLogo" type="file" accept="image/png, image/svg+xml, image/jpeg"/>
      <div class="row">
        <label>–†–∞–∑–º–µ—Ä —Ç–µ–∫—Å—Ç–∞</label>
        <input id="brandSize" type="number" value="42" min="16" max="120"/>
      </div>
      <div id="lettersPanel" class="letters" style="display:none"></div>
    </div>

    <div class="group">
      <h3>–¢–µ–º–∞</h3>
      <div class="row">
        <div class="colorRow">
          <label style="margin:0">–§–æ–Ω</label>
          <input type="color" id="bgColor">
          <input type="text" id="bgHex" value="#F7E6CA">
        </div>
        <div class="colorRow">
          <label style="margin:0">–ü–æ–≤–µ—Ä—Ö–Ω–æ—Å—Ç—å</label>
          <input type="color" id="surfaceColor">
          <input type="text" id="surfaceHex" value="#FFF5E6">
        </div>
      </div>
      <div class="row">
        <div class="colorRow">
          <label style="margin:0">–ê–∫—Ü–µ–Ω—Ç</label>
          <input type="color" id="accentColor">
          <input type="text" id="accentHex" value="#FF7A00">
        </div>
        <div class="colorRow">
          <label style="margin:0">–¢–µ–∫—Å—Ç</label>
          <input type="color" id="textColor">
          <input type="text" id="textHex" value="#2A2A1A">
        </div>
      </div>
      <div class="row">
        <div>
          <label>–†–∞–¥–∏—É—Å –∫–∞—Ä—Ç–æ—á–µ–∫</label>
          <input id="radius" type="number" value="16" min="0" max="40">
        </div>
        <div>
          <label>–ö–æ–ª–æ–Ω–∫–∏</label>
          <input id="cols" type="number" value="4" min="1" max="8">
        </div>
      </div>
    </div>

    <div class="group">
      <h3>–î–µ–π—Å—Ç–≤–∏—è</h3>
      <div class="row">
        <button class="btn secondary" id="btnUndo">Undo</button>
        <button class="btn secondary" id="btnRedo">Redo</button>
      </div>
      <p class="ghostTip">–ì–æ—Ä—è—á–∏–µ –∫–ª–∞–≤–∏—à–∏: <b>Ctrl+Z</b> –∏ <b>Ctrl+Shift+Z</b>.</p>
    </div>
  </aside>

  <main>
    <div id="header">
      <div class="brandBox" data-draggable="brand">
        <img id="logo" alt="logo"/>
        <div id="brandName"></div>
      </div>
      <div class="ghostTip">–ü–µ—Ä–µ—Ç–∞—Å–∫–∏–≤–∞–π—Ç–µ —ç–ª–µ–º–µ–Ω—Ç—ã –ø—Ä–∏ –≤–∫–ª—é—á–µ–Ω–Ω–æ–º ¬´–°–≤–æ–±–æ–¥–Ω–æ–µ –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏–µ¬ª</div>
    </div>

    <div class="canvas">
      <div id="grid" class="grid"></div>
    </div>
  </main>
</div>

<script>
  // ===== Helpers =====
  const $ = (sel, ctx=document) => ctx.querySelector(sel);
  const $$ = (sel, ctx=document) => Array.from(ctx.querySelectorAll(sel));
  const statusEl = $('#status');
  const grid = $('#grid');
  const body = document.body;

  const defaultCards = [
    { id: 'realestate', title:'–ù–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç—å', hint:'–ö–≤–∞—Ä—Ç–∏—Ä—ã, –¥–æ–º–∞ –∏ —É—á–∞—Å—Ç–∫–∏', icon:'üè†', link:'' },
    { id: 'cars',       title:'–¢—Ä–∞–Ω—Å–ø–æ—Ä—Ç',     hint:'–õ–µ–≥–∫–æ–≤—ã–µ –∏ –≥—Ä—É–∑–æ–≤—ã–µ',    icon:'üöó', link:'' },
    { id: 'electronics',title:'–≠–ª–µ–∫—Ç—Ä–æ–Ω–∏–∫–∞',   hint:'–¢–µ–ª–µ—Ñ–æ–Ω—ã –∏ —Ç–µ—Ö–Ω–∏–∫–∞',     icon:'üíª', link:'' },
    { id: 'jobs',       title:'–†–∞–±–æ—Ç–∞',        hint:'–í–∞–∫–∞–Ω—Å–∏–∏ –∏ —Ä–µ–∑—é–º–µ',      icon:'üíº', link:'' },
    { id: 'services',   title:'–£—Å–ª—É–≥–∏',        hint:'–†–µ–º–æ–Ω—Ç, –≥—Ä—É–∑–æ–ø–µ—Ä–µ–≤–æ–∑–∫–∏', icon:'üõ†Ô∏è', link:'' },
    { id: 'furniture',  title:'–ú–µ–±–µ–ª—å',        hint:'–î–∏–≤–∞–Ω—ã, —à–∫–∞—Ñ—ã, —Å—Ç–æ–ª—ã',   icon:'üõãÔ∏è', link:'' },
    { id: 'fashion',    title:'–û–¥–µ–∂–¥–∞',        hint:'–ú—É–∂—Å–∫–∞—è –∏ –∂–µ–Ω—Å–∫–∞—è',      icon:'üëï', link:'' },
    { id: 'hobbies',    title:'–•–æ–±–±–∏',         hint:'–°–ø–æ—Ä—Ç –∏ –æ—Ç–¥—ã—Ö',          icon:'üö¥', link:'' }
  ];

  const state = {
    theme:{
      bg:'#F7E6CA', surface:'#FFF5E6', accent:'#FF7A00', text:'#2A2A1A',
      radius:16, cols:4
    },
    brand:{
      text:'MySale', size:42, perLetters:false, letters:[], logo:'', pos:null
    },
    freeMove:false,
    cards: defaultCards.map((c,i)=>({...c, pos:null}))
  };

  // ===== Undo/Redo =====
  const undoStack=[]; const redoStack=[];
  function pushHistory(){
    undoStack.push(JSON.stringify(state));
    if(undoStack.length>80) undoStack.shift();
    redoStack.length=0;
  }
  function doUndo(){
    if(!undoStack.length) return;
    redoStack.push(JSON.stringify(state));
    const prev = undoStack.pop();
    Object.assign(state, JSON.parse(prev));
    renderAll();
    tip('–û—Ç–º–µ–Ω–µ–Ω–æ');
  }
  function doRedo(){
    if(!redoStack.length) return;
    undoStack.push(JSON.stringify(state));
    const next = redoStack.pop();
    Object.assign(state, JSON.parse(next));
    renderAll();
    tip('–ü–æ–≤—Ç–æ—Ä–µ–Ω–æ');
  }
  $('#btnUndo').onclick=doUndo;
  $('#btnRedo').onclick=doRedo;
  window.addEventListener('keydown',e=>{
    if(e.ctrlKey && e.key==='z'){ e.preventDefault(); doUndo(); }
    if(e.ctrlKey && e.shiftKey && e.key.toLowerCase()==='z'){ e.preventDefault(); doRedo(); }
  });

  // ===== Theme bindings =====
  function syncColor(pairId, initVal){
    const color = $(pairId+'Color'), hex=$(pairId+'Hex');
    color.value = initVal; hex.value = initVal;
    color.oninput = e=>{ hex.value = e.target.value.toUpperCase(); applyTheme(); };
    hex.oninput = e=>{
      const v=e.target.value.trim();
      if(/^#([0-9a-f]{3}|[0-9a-f]{6})$/i.test(v)){ color.value=v; applyTheme(); }
    };
  }
  syncColor('#bg', state.theme.bg);
  syncColor('#surface', state.theme.surface);
  syncColor('#accent', state.theme.accent);
  syncColor('#text', state.theme.text);
  $('#radius').value=state.theme.radius;
  $('#cols').value=state.theme.cols;
  $('#radius').oninput = ()=>{ state.theme.radius = +$('#radius').value; applyTheme(); };
  $('#cols').oninput = ()=>{ state.theme.cols = Math.max(1, +$('#cols').value); applyTheme(); };

  function applyTheme(){
    pushHistory();
    state.theme.bg = $('#bgHex').value;
    state.theme.surface = $('#surfaceHex').value;
    state.theme.accent = $('#accentHex').value;
    state.theme.text = $('#textHex').value;
    document.documentElement.style.setProperty('--bg', state.theme.bg);
    document.documentElement.style.setProperty('--surface', state.theme.surface);
    document.documentElement.style.setProperty('--accent', state.theme.accent);
    document.documentElement.style.setProperty('--text', state.theme.text);
    document.documentElement.style.setProperty('--radius', state.theme.radius+'px');
    document.documentElement.style.setProperty('--cols', state.theme.cols);
  }

  // ===== Brand =====
  const brandInput = $('#brandInput');
  const brandName = $('#brandName');
  const perLetter = $('#perLetter');
  const brandSize = $('#brandSize');
  const lettersPanel = $('#lettersPanel');
  const logo = $('#logo'); const logoPreview = $('#logoPreview');
  brandInput.value = state.brand.text;
  brandSize.value = state.brand.size;
  perLetter.checked = state.brand.perLetters;

  function renderBrand(){
    brandName.style.fontSize = state.brand.size+'px';
    brandName.innerHTML='';
    const letters = [...state.brand.text];
    if(state.brand.perLetters && state.brand.letters.length !== letters.length){
      state.brand.letters = letters.map((ch,i)=>({ch,color:'#'+Math.floor(Math.random()*0xffffff).toString(16).padStart(6,'0')}));
    }
    if(state.brand.perLetters){
      letters.forEach((ch,i)=>{
        const sp = document.createElement('span');
        sp.textContent = ch;
        sp.style.color = state.brand.letters[i]?.color || 'var(--text)';
        brandName.appendChild(sp);
      });
      lettersPanel.style.display='flex';
      lettersPanel.innerHTML='';
      letters.forEach((ch,i)=>{
        const box=document.createElement('div'); box.className='letter';
        box.innerHTML = `<b>${ch}</b><input type="color" value="${state.brand.letters[i].color}">`;
        box.querySelector('input').oninput = (e)=>{
          pushHistory(); state.brand.letters[i].color = e.target.value; renderBrand();
        };
        lettersPanel.appendChild(box);
      });
    }else{
      lettersPanel.style.display='none';
      letters.forEach(ch=>{
        const sp=document.createElement('span'); sp.textContent=ch; brandName.appendChild(sp);
      });
    }
  }
  brandInput.oninput = ()=>{ pushHistory(); state.brand.text = brandInput.value || ' '; renderBrand(); };
  perLetter.oninput = ()=>{ pushHistory(); state.brand.perLetters = perLetter.checked; renderBrand(); };
  brandSize.oninput = ()=>{ pushHistory(); state.brand.size = +brandSize.value; renderBrand(); };

  $('#fileLogo').addEventListener('change', e=>{
    const f = e.target.files?.[0]; if(!f) return;
    const rd = new FileReader();
    rd.onload = ev=>{
      pushHistory();
      state.brand.logo = ev.target.result;
      logo.src = logoPreview.src = state.brand.logo;
      logo.style.background='transparent';
      logoPreview.style.background='transparent';
    };
    rd.readAsDataURL(f);
  });

  // ===== Cards =====
  function cardEl(card){
    const el=document.createElement('div'); el.className='card'; el.dataset.id=card.id;
    el.innerHTML = `
      <div class="linkBadge" title="–°—Å—ã–ª–∫–∞ –¥–ª—è –∫–ª–∏–∫–∞ –ø–æ –∫–∞—Ä—Ç–æ—á–∫–µ">üîó link</div>
      <div class="icon" contenteditable="plaintext-only">${card.icon||'‚¨ú'}</div>
      <div class="title" contenteditable="plaintext-only">${card.title}</div>
      <p class="hint" contenteditable="plaintext-only">${card.hint||''}</p>
    `;
    const openLink = (e)=>{
      if(e.target.closest('.linkBadge')){
        const url = prompt('–£–∫–∞–∂–∏—Ç–µ URL (–ø–æ–ª–Ω—É—é —Å—Å—ã–ª–∫—É):', card.link||'');
        if(url!=null){ pushHistory(); card.link=url; tip('–°—Å—ã–ª–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∞'); }
        return;
      }
      if(card.link && !state.freeMove) window.open(card.link,'_blank');
    };
    el.addEventListener('dblclick', openLink);
    el.querySelector('.title').addEventListener('input',e=>{ card.title=e.target.textContent; saveQuiet(); });
    el.querySelector('.hint').addEventListener('input',e=>{ card.hint=e.target.textContent; saveQuiet(); });
    el.querySelector('.icon').addEventListener('input',e=>{ card.icon=e.target.textContent||'‚¨ú'; saveQuiet(); });
    return el;
  }
  function renderCards(){
    grid.innerHTML='';
    state.cards.forEach((c,i)=>{
      const el = cardEl(c); grid.appendChild(el);
    });
    applyFreeMove(); // restore positions if were
  }

  // ===== Free move / Drag =====
  const freeMove = $('#freeMove');
  freeMove.checked = state.freeMove;
  freeMove.oninput = ()=>{ pushHistory(); state.freeMove=freeMove.checked; applyFreeMove(); };

  function applyFreeMove(){
    document.body.classList.toggle('freemove', state.freeMove);
    const cardNodes = $$('.card', grid);
    if(state.freeMove){
      // Switch to absolute positions
      cardNodes.forEach((el,idx)=>{
        const c = state.cards[idx];
        const r = el.getBoundingClientRect();
        const g = grid.getBoundingClientRect();
        if(!c.pos) c.pos = {x: r.left-g.left, y:r.top-g.top};
        el.style.left = c.pos.x+'px';
        el.style.top  = c.pos.y+'px';
        el.style.width = r.width+'px';
      });
      $('.brandBox').style.position='absolute';
      if(!state.brand.pos){
        const b = $('.brandBox').getBoundingClientRect();
        const h = $('#header').getBoundingClientRect();
        state.brand.pos = {x:b.left-h.left, y:b.top-h.top};
      }
      const bb = $('.brandBox');
      const h = $('#header').getBoundingClientRect();
      bb.style.left = state.brand.pos.x+'px';
      bb.style.top  = state.brand.pos.y+'px';

      enableDrag([...cardNodes, $('.brandBox')], (el)=>{
        if(el.classList.contains('card')){
          const idx = Array.from(grid.children).indexOf(el);
          const c = state.cards[idx];
          c.pos = { x: parseFloat(el.style.left), y: parseFloat(el.style.top) };
        }else{
          state.brand.pos = { x: parseFloat(el.style.left), y: parseFloat(el.style.top) };
        }
        saveQuiet();
      }, grid, $('#header'));
    }else{
      // Back to grid flow
      disableDrag();
      cardNodes.forEach(el=>{ el.style.left=el.style.top=el.style.width=''; });
      $('.brandBox').style.left=$('.brandBox').style.top='';
      $('.brandBox').style.position='relative';
    }
  }

  let dragData=null;
  function enableDrag(els, onStop, gridBox, headerBox){
    els.forEach(el=>{
      el.onpointerdown = (e)=>{
        if(!state.freeMove) return;
        dragData = { el, startX:e.clientX, startY:e.clientY };
        const r = el.getBoundingClientRect();
        dragData.offsetX = e.clientX - r.left;
        dragData.offsetY = e.clientY - r.top;
        el.setPointerCapture(e.pointerId);
      };
      el.onpointermove = (e)=>{
        if(!dragData || dragData.el!==el) return;
        const parent = el.classList.contains('card') ? gridBox : headerBox;
        const p = parent.getBoundingClientRect();
        let x = e.clientX - p.left - dragData.offsetX;
        let y = e.clientY - p.top - dragData.offsetY;
        x = Math.max(0, Math.min(x, p.width - el.offsetWidth));
        y = Math.max(0, Math.min(y, p.height - el.offsetHeight));
        el.style.left = x+'px'; el.style.top=y+'px';
      };
      el.onpointerup = (e)=>{
        if(!dragData || dragData.el!==el) return;
        el.releasePointerCapture(e.pointerId);
        dragData=null;
        onStop?.(el);
      };
    });
  }
  function disableDrag(){
    $$('.card, .brandBox').forEach(el=>{
      el.onpointerdown = el.onpointermove = el.onpointerup = null;
    });
  }

  // ===== Save/Load/Export =====
  function tip(t){ statusEl.textContent=t; clearTimeout(tip._t); tip._t=setTimeout(()=>statusEl.textContent='',1500); }
  function saveQuiet(){ localStorage.setItem('mysale_admin_v3', JSON.stringify(state)); }
  function save(){ pushHistory(); saveQuiet(); tip('–°–æ—Ö—Ä–∞–Ω–µ–Ω–æ'); }
  function load(){
    const raw = localStorage.getItem('mysale_admin_v3');
    if(!raw){ pushHistory(); renderAll(); return; }
    try{
      const obj = JSON.parse(raw);
      Object.assign(state, obj);
      renderAll();
    }catch(e){ console.warn('load failed', e); pushHistory(); renderAll(); }
  }
  $('#btnSave').onclick=save;
  $('#btnExport').onclick=()=>{
    const blob=new Blob([JSON.stringify(state,null,2)],{type:'application/json'});
    const a=document.createElement('a'); a.href=URL.createObjectURL(blob); a.download='mysale_admin_state.json'; a.click();
  };
  $('#fileImport').onchange=e=>{
    const f=e.target.files?.[0]; if(!f) return;
    const rd=new FileReader(); rd.onload=ev=>{
      try{
        const obj=JSON.parse(ev.target.result);
        pushHistory();
        Object.assign(state,obj);
        renderAll();
        tip('–ò–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–æ');
      }catch(e){ alert('–ù–µ —É–¥–∞–ª–æ—Å—å –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å JSON'); }
    }; rd.readAsText(f);
  };

  // ===== Render =====
  function renderAll(){
    // theme
    $('#bgHex').value = state.theme.bg; $('#bgColor').value=state.theme.bg;
    $('#surfaceHex').value = state.theme.surface; $('#surfaceColor').value=state.theme.surface;
    $('#accentHex').value = state.theme.accent; $('#accentColor').value=state.theme.accent;
    $('#textHex').value = state.theme.text; $('#textColor').value=state.theme.text;
    $('#radius').value=state.theme.radius; $('#cols').value=state.theme.cols;
    applyTheme();

    // brand
    brandInput.value=state.brand.text; perLetter.checked=state.brand.perLetters; brandSize.value=state.brand.size;
    renderBrand();
    if(state.brand.logo){ logo.src=logoPreview.src=state.brand.logo; logo.style.background='transparent'; logoPreview.style.background='transparent'; }
    else { logo.removeAttribute('src'); logoPreview.removeAttribute('src'); }

    // cards
    renderCards();

    // free move
    freeMove.checked = state.freeMove;
    applyFreeMove();
  }

  // initial
  pushHistory();
  load();
</script>
</body>
</html>
