<!doctype html>
<html lang="ru">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Admin ‚Äî —Ä—è–¥—ã —Ñ–∏–ª—å—Ç—Ä–æ–≤ + –±–µ—Å–∫–æ–Ω–µ—á–Ω—ã–µ —Å–≤—è–∑–∏</title>
<script src="https://cdn.jsdelivr.net/npm/sortablejs@1.15.0/Sortable.min.js"></script>
<style>
/* —Å—Ç–∏–ª–∏ –∫–∞–∫ –≤ –æ—Ä–∏–≥–∏–Ω–∞–ª–µ, —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã –ø–æ–ª–Ω–æ—Å—Ç—å—é */
</style>
</head>
<body>
<header>
  <div class="tabs">
    <div class="tab active" data-tab="filters">‚öôÔ∏è –§–∏–ª—å—Ç—Ä—ã –∏ —Ä—è–¥—ã</div>
    <div class="tab" data-tab="fields">üìù –ü–æ–ª—è —Ñ–æ—Ä–º—ã</div>
    <div class="tab" data-tab="layout">üñºÔ∏è –ú–∞–∫–µ—Ç</div>
    <div class="tab" data-tab="preview">üëÄ –ü—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä</div>
  </div>
  <button class="btn secondary" id="exportBtn">–≠–∫—Å–ø–æ—Ä—Ç</button>
  <label class="btn secondary">–ò–º–ø–æ—Ä—Ç<input id="importInput" type="file" hidden></label>
  <button class="btn ghost" id="resetBtn">–°–±—Ä–æ—Å</button>
</header>

<main>
  <!-- —Ñ–∏–ª—å—Ç—Ä—ã, –ø–æ–ª—è, –º–∞–∫–µ—Ç, –ø—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä ‚Äî –ø–æ–ª–Ω–æ—Å—Ç—å—é –∫–∞–∫ –≤ –æ—Ä–∏–≥–∏–Ω–∞–ª–µ -->
</main>

<div class="modal" id="modal">
  <div class="card">
    <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:8px">
      <strong id="modalTitle">–†–µ–¥–∞–∫—Ç–æ—Ä</strong>
      <button class="btn ghost" onclick="closeModal()">–ó–∞–∫—Ä—ã—Ç—å</button>
    </div>
    <div id="modalBody"></div>
  </div>
</div>

<div class="toast" id="toast"></div>

<script>
// ... –ø–æ–ª–Ω—ã–π js –∫–∞–∫ –≤ –æ—Ä–∏–≥–∏–Ω–∞–ª–µ, –Ω–æ —Å –ø—Ä–∞–≤–∫–∞–º–∏:

// 1. showToast (–Ω–æ–≤–∞—è —Ñ—É–Ω–∫—Ü–∏—è)
function showToast(msg){
  const t=document.getElementById("toast");
  t.textContent=msg; t.classList.add("show");
  clearTimeout(window.__toastT);
  window.__toastT=setTimeout(()=>t.classList.remove("show"),2000);
}

// 2. —ç–∫—Å–ø–æ—Ä—Ç/–∏–º–ø–æ—Ä—Ç ‚Äî –¥–æ–±–∞–≤–ª–µ–Ω –≤—ã–∑–æ–≤ showToast()
exportBtn.onclick=()=>{
  const blob=new Blob([JSON.stringify(data,null,2)],{type:"application/json"});
  const url=URL.createObjectURL(blob);
  const a=document.createElement("a");
  a.href=url; a.download="admin-config.json"; a.click();
  URL.revokeObjectURL(url);
  showToast("–≠–∫—Å–ø–æ—Ä—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω");
};
importInput.addEventListener("change",async e=>{
  const f=e.target.files?.[0]; if(!f) return;
  try{
    const txt=await f.text(); data=JSON.parse(txt); save(); renderAll();
    showToast("–ò–º–ø–æ—Ä—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω");
  }catch(err){ showToast("–û—à–∏–±–∫–∞ –∏–º–ø–æ—Ä—Ç–∞"); }
});

// 3. onFilterChange ‚Äî —É–±—Ä–∞–Ω –ª–∏—à–Ω–∏–π renderGroups()
function onFilterChange(field,key,val){
  const f=byField(field); if(!f) return;
  f[key]=val; save();
  if(key==='type') renderGroups();
  renderFiltersTable(); renderPreview();
}

// 4. renderLayout ‚Äî –¥–æ–±–∞–≤–ª–µ–Ω –∫—Ä–µ—Å—Ç–∏–∫
function renderLayout(){
  canvas.innerHTML="";
  data.layout.forEach((b,i)=>{
    const el=document.createElement("div"); el.className="block";
    el.style.gridColumn=`${b.x}/span ${b.w}`;
    el.style.gridRow=`${b.y}/span ${b.h}`;
    el.innerHTML=`${labelByType(b.type)}<div class="resize"></div><button class="close" onclick="removeBlock(${i})">√ó</button>`;
    canvas.appendChild(el);
  });
}
function removeBlock(i){ data.layout.splice(i,1); save(); renderLayout(); renderPreview(); }

// –æ—Å—Ç–∞–ª—å–Ω–æ–π –∫–æ–¥ (–ø—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä, –º–æ–¥–∞–ª–∫–∏, –≥—Ä—É–ø–ø—ã, —Ñ–∏–ª—å—Ç—Ä—ã) –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π
</script>
</body>
</html>