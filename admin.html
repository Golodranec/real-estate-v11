<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Admin ‚Äî —Ä—è–¥—ã —Ñ–∏–ª—å—Ç—Ä–æ–≤ + –±–µ—Å–∫–æ–Ω–µ—á–Ω—ã–µ —Å–≤—è–∑–∏</title>
  <script src="https://cdn.jsdelivr.net/npm/sortablejs@1.15.0/Sortable.min.js"></script>
  <style>
    body { margin:0; background:#0f1115; color:#e6e6e6; font:14px system-ui; }
    header { padding:10px; background:#161a22; display:flex; gap:10px; flex-wrap:wrap; }
    .tab { padding:6px 12px; background:#2a3140; border-radius:6px; cursor:pointer; }
    .tab.active { background:#5b9cff; color:#fff; }
    .btn { padding:6px 10px; border-radius:6px; cursor:pointer; border:none; }
    .btn.secondary { background:#2a3140; color:#fff; }
    .btn.ghost { background:transparent; border:1px solid #2a3140; color:#e6e6e6; }
    main { display:grid; grid-template-columns:1fr 1fr; min-height:90vh; }
    .panel { padding:12px; overflow:auto; }
    .group { border:1px solid #2a3140; border-radius:10px; padding:10px; margin:10px 0; }
    .list { display:flex; flex-wrap:wrap; gap:8px; }
    .filter-chip { display:flex; gap:6px; align-items:center; background:#1a202c; padding:8px; border-radius:8px; }
    .canvas { display:grid; grid-template-columns:repeat(12,1fr); grid-auto-rows:80px; gap:6px; background:#0b0d12; border:1px dashed #333; padding:6px; min-height:60vh; }
    .block { background:#1f2530; border:1px solid #2a3140; border-radius:10px; display:flex; align-items:center; justify-content:center; position:relative; }
    .resize { position:absolute; right:0; bottom:0; width:12px; height:12px; background:#5b9cff; cursor:se-resize; }
    .block .close { position:absolute; top:4px; right:4px; background:#e53e3e; border:none; border-radius:50%; width:20px; height:20px; color:#fff; cursor:pointer; }
    .preview-grid { display:grid; grid-template-columns:repeat(12,1fr); grid-auto-rows:80px; gap:6px; background:#0b0d12; border:1px solid #2a3140; padding:6px; }
    .preview-block { background:#1a202c; border-radius:8px; padding:8px; }
    .filters-row { display:flex; gap:10px; flex-wrap:wrap; margin-bottom:10px; }
    .field { min-width:140px; }
    .modal { position:fixed; inset:0; background:rgba(0,0,0,.5); display:none; align-items:center; justify-content:center; }
    .card { background:#0b0f17; padding:14px; border-radius:10px; max-height:90vh; overflow:auto; }
    .toast { position:fixed; bottom:20px; right:20px; background:#1f2530; padding:10px 14px; border-radius:6px; color:#fff; opacity:0; transition:.3s; }
    .toast.show { opacity:1; }
  </style>
</head>
<body>
  <header>
    <div class="tabs">
      <div class="tab active" data-tab="filters">‚öôÔ∏è –§–∏–ª—å—Ç—Ä—ã</div>
      <div class="tab" data-tab="fields">üìù –ü–æ–ª—è</div>
      <div class="tab" data-tab="layout">üñºÔ∏è –ú–∞–∫–µ—Ç</div>
      <div class="tab" data-tab="preview">üëÄ –ü—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä</div>
    </div>
    <button class="btn secondary" id="exportBtn">–≠–∫—Å–ø–æ—Ä—Ç</button>
    <label class="btn secondary">–ò–º–ø–æ—Ä—Ç<input id="importInput" type="file" hidden></label>
    <button class="btn ghost" id="resetBtn">–°–±—Ä–æ—Å</button>
  </header>

  <main>
    <section class="panel" id="filtersPanel"></section>
    <section class="panel" id="fieldsPanel" style="display:none"></section>
    <section class="panel" id="layoutPanel" style="display:none"></section>
    <section class="panel" id="previewPanel" style="display:none"></section>
  </main>

  <div class="modal" id="modal"><div class="card"><h3 id="modalTitle"></h3><div id="modalBody"></div><button onclick="closeModal()">–ó–∞–∫—Ä—ã—Ç—å</button></div></div>
  <div class="toast" id="toast"></div>

  <script>
    const KEY="admin_config";
    let data=load()||demoData(), previewState={};

    function load(){try{return JSON.parse(localStorage.getItem(KEY))}catch(e){return null}}
    function save(){localStorage.setItem(KEY,JSON.stringify(data))}
    function demoData(){return{groups:[{id:1,name:"–í–µ—Ä—Ö–Ω—è—è",filters:["country","city"]}],filters:[{label:"–°—Ç—Ä–∞–Ω–∞",field:"country",type:"select",options:["–£–∑–±–µ–∫–∏—Å—Ç–∞–Ω"]},{label:"–ì–æ—Ä–æ–¥",field:"city",type:"select",options:["–¢–∞—à–∫–µ–Ω—Ç","–°–∞–º–∞—Ä–∫–∞–Ω–¥"]}],fields:[{label:"–ó–∞–≥–æ–ª–æ–≤–æ–∫",id:"title",type:"text"}],layout:[{id:1,type:"filters",x:1,y:1,w:12,h:2}]};}

    document.querySelectorAll(".tab").forEach(t=>t.onclick=()=>{document.querySelectorAll(".tab").forEach(x=>x.classList.remove("active"));t.classList.add("active");["filters","fields","layout","preview"].forEach(id=>document.getElementById(id+"Panel").style.display=t.dataset.tab===id?"block":"none");renderAll()});

    document.getElementById("exportBtn").onclick=()=>{const blob=new Blob([JSON.stringify(data,null,2)],{type:"application/json"});const url=URL.createObjectURL(blob);const a=document.createElement("a");a.href=url;a.download="config.json";a.click();showToast("–≠–∫—Å–ø–æ—Ä—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω");};
    document.getElementById("importInput").onchange=async e=>{const f=e.target.files[0];if(!f)return;const txt=await f.text();data=JSON.parse(txt);save();renderAll();showToast("–ò–º–ø–æ—Ä—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω");};
    document.getElementById("resetBtn").onclick=()=>{localStorage.removeItem(KEY);location.reload()};

    function showToast(msg){const t=document.getElementById("toast");t.textContent=msg;t.classList.add("show");setTimeout(()=>t.classList.remove("show"),2000);}

    function renderAll(){renderGroups();renderFields();renderLayout();renderPreview();}
    function renderGroups(){document.getElementById("filtersPanel").innerHTML="";}
    function renderFields(){document.getElementById("fieldsPanel").innerHTML="";}
    function renderLayout(){const c=document.getElementById("layoutPanel");c.innerHTML="<div class='canvas' id='canvas'></div>";const canvas=document.getElementById("canvas");data.layout.forEach((b,i)=>{const el=document.createElement("div");el.className="block";el.style.gridColumn=`${b.x}/span ${b.w}`;el.style.gridRow=`${b.y}/span ${b.h}`;el.innerHTML=`${b.type}<div class='resize'></div><button class='close' onclick='removeBlock(${i})'>√ó</button>`;canvas.appendChild(el)});}
    function removeBlock(i){data.layout.splice(i,1);save();renderLayout();renderPreview();}

    function renderPreview(){const p=document.getElementById("previewPanel");p.innerHTML="<div class='preview-grid' id='prev'></div>";const box=document.getElementById("prev");data.layout.forEach(b=>{const el=document.createElement("div");el.className="preview-block";el.style.gridColumn=`${b.x}/span ${b.w}`;el.style.gridRow=`${b.y}/span ${b.h}`;if(b.type==="filters"){el.appendChild(renderPreviewFilters())}else{el.textContent=b.type;}box.appendChild(el)});}
    function renderPreviewFilters(){const wrap=document.createElement("div");data.groups.forEach(g=>{const row=document.createElement("div");row.className="filters-row";g.filters.forEach(fld=>{const f=data.filters.find(x=>x.field===fld);if(!f)return;const box=document.createElement("div");box.className="field";box.innerHTML=`<label>${f.label}</label>`;if(f.type==="select"){const sel=document.createElement("select");sel.innerHTML=f.options.map(o=>`<option ${previewState[f.field]===o?'selected':''}>${o}</option>`).join("");sel.onchange=()=>{previewState[f.field]=sel.value;renderPreview()};box.appendChild(sel);}else{box.innerHTML+=`<input>`;}row.appendChild(box)});wrap.appendChild(row)});return wrap;}

    function openModal(t,html){document.getElementById("modalTitle").textContent=t;document.getElementById("modalBody").innerHTML=html;document.getElementById("modal").style.display="flex";}
    function closeModal(){document.getElementById("modal").style.display="none";}

    renderAll();
  </script>
</body>
</html>
