<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <title>Админка — v13.9.10 (dev)</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    :root{
      --bg:#0f1115; --card:#161a22; --line:#242938; --text:#e8eaf0; --blue:#4da3ff;
    }
    body{margin:0;font-family:system-ui,Arial,sans-serif;background:var(--bg);color:var(--text)}
    header{display:flex;align-items:center;justify-content:space-between;padding:14px;border-bottom:1px solid var(--line);background:var(--card)}
    h1{margin:0;font-size:18px}
    .wrap{max-width:1200px;margin:0 auto;padding:14px}
    .card{background:var(--card);border:1px solid var(--line);border-radius:12px;padding:14px;margin-bottom:14px}
    .row{display:flex;gap:8px;flex-wrap:wrap;align-items:center}
    input,select,button{padding:6px;border-radius:6px;border:1px solid var(--line);background:#0d1016;color:var(--text)}
    button{cursor:pointer}
    .btn{background:var(--blue);border:1px solid var(--blue);color:#001428;font-weight:600}
    .danger{background:#ff6b6b;border:1px solid #ff6b6b;color:#fff}
    .blocks,.fields{display:flex;flex-direction:column;gap:6px}
    .block-item,.field-item{display:grid;gap:6px;align-items:center;padding:6px;border:1px solid var(--line);border-radius:8px;background:#0d1016;cursor:grab}
    .block-item.dragging,.field-item.dragging{opacity:.5}
    .mini{font-size:12px;opacity:.7}
    .preview{margin-top:20px;padding:14px;border:2px dashed var(--line);border-radius:12px;background:#1b1f29}
    .preview-block{border:1px solid var(--line);border-radius:8px;padding:10px;margin:6px 0;background:#0d1016}
    .preview-form{display:flex;flex-direction:column;gap:8px}
    .preview-form input,.preview-form textarea,.preview-form select{width:100%;padding:6px;border-radius:6px;border:1px solid var(--line);background:#fff;color:#000}
    .fake-card{border:1px solid #ccc;border-radius:6px;background:#fff;color:#000;margin:6px 0;padding:8px;display:flex;gap:8px;align-items:center}
    .fake-card img{width:60px;height:45px;object-fit:cover;border-radius:4px;background:#ddd}
    .fake-filter{margin:4px 0}
    .fake-map{display:flex;align-items:center;justify-content:center;background:#2c3140;color:#aaa;font-size:24px;border-radius:6px}
  </style>
</head>
<body>
<header>
  <h1>Админка — v13.9.10 (dev)</h1>
  <a href="index.html" style="color:var(--blue)">← к каталогу</a>
</header>

<div class="wrap">
  <div class="card">
    <h3>Структура страницы</h3>
    <div id="blocksList" class="blocks"></div>
    <button id="resetLayout" class="danger">Сбросить</button>
  </div>

  <div class="card">
    <h3>Поля формы</h3>
    <div id="fieldsList" class="fields"></div>
    <button id="resetFields" class="danger">Сбросить поля</button>
  </div>

  <div class="card">
    <h3>Шаблоны раскладок</h3>
    <div class="row">
      <input id="layoutName" placeholder="Имя шаблона" />
      <button id="saveLayoutBtn" class="btn">Сохранить</button>
    </div>
    <div id="layoutsList" style="margin-top:10px"></div>
  </div>

  <div class="card">
    <h3>Живой предпросмотр</h3>
    <div id="preview" class="preview"></div>
  </div>
</div>

<script>
const $=id=>document.getElementById(id);

const DEFAULT_LAYOUT=[
  {id:"filters",title:"Фильтры",enabled:true,width:1,height:0},
  {id:"map",title:"Карта",enabled:true,width:2,height:300},
  {id:"results",title:"Результаты",enabled:true,width:1,height:0},
  {id:"form",title:"Форма",enabled:true,width:1,height:0}
];
const DEFAULT_FIELDS=[
  {id:"title",label:"Заголовок",type:"text",required:true,placeholder:"Введите название",enabled:true},
  {id:"price",label:"Цена",type:"number",required:true,placeholder:"в сумах",enabled:true},
  {id:"area",label:"Площадь",type:"number",required:false,placeholder:"например 60",enabled:true},
  {id:"desc",label:"Описание",type:"textarea",required:false,placeholder:"",enabled:false}
];

let pageLayout=JSON.parse(localStorage.getItem("pageLayout")||JSON.stringify(DEFAULT_LAYOUT));
let formFields=JSON.parse(localStorage.getItem("formFields")||JSON.stringify(DEFAULT_FIELDS));
let savedLayouts=JSON.parse(localStorage.getItem("layouts")||"[]");

/* Blocks */
function renderBlocks(){
  const list=$("blocksList"); list.innerHTML="";
  pageLayout.forEach((b,i)=>{
    const row=document.createElement("div"); row.className="block-item"; row.draggable=true; row.dataset.index=i;
    const chk=document.createElement("input"); chk.type="checkbox"; chk.checked=b.enabled; chk.onchange=()=>{b.enabled=chk.checked;saveLayout();};
    const title=document.createElement("input"); title.value=b.title; title.oninput=()=>{b.title=title.value;saveLayout();};
    row.append(chk,title); list.appendChild(row);
    row.addEventListener("dragstart",()=>row.classList.add("dragging"));
    row.addEventListener("dragend",()=>{row.classList.remove("dragging");updateOrder(list,pageLayout,saveLayout);});
  });
}
function saveLayout(){localStorage.setItem("pageLayout",JSON.stringify(pageLayout)); renderBlocks(); renderPreview();}
$("resetLayout").onclick=()=>{pageLayout=JSON.parse(JSON.stringify(DEFAULT_LAYOUT));saveLayout();};

/* Fields */
function renderFields(){
  const list=$("fieldsList"); list.innerHTML="";
  formFields.forEach((f,i)=>{
    const row=document.createElement("div"); row.className="field-item"; row.draggable=true; row.dataset.index=i;
    const chk=document.createElement("input"); chk.type="checkbox"; chk.checked=f.enabled; chk.onchange=()=>{f.enabled=chk.checked;saveFields();};
    const label=document.createElement("input"); label.value=f.label; label.oninput=()=>{f.label=label.value;saveFields();};
    row.append(chk,label); list.appendChild(row);
    row.addEventListener("dragstart",()=>row.classList.add("dragging"));
    row.addEventListener("dragend",()=>{row.classList.remove("dragging");updateOrder(list,formFields,saveFields);});
  });
}
function saveFields(){localStorage.setItem("formFields",JSON.stringify(formFields)); renderFields(); renderPreview();}
$("resetFields").onclick=()=>{formFields=JSON.parse(JSON.stringify(DEFAULT_FIELDS));saveFields();};

/* Drag helper */
function updateOrder(list,arr,save){
  const items=[...list.querySelectorAll("[draggable]")];
  arr=items.map(it=>arr[+it.dataset.index]);
  if(arr[0].id) pageLayout=arr; else formFields=arr;
  save();
}

/* Layout Templates */
function renderLayouts(){const box=$("layoutsList");box.innerHTML="";savedLayouts.forEach((l,i)=>{const row=document.createElement("div");row.className="row";row.innerHTML=`<b>${l.name}</b>`;const load=document.createElement("button");load.textContent="Загрузить";load.onclick=()=>{pageLayout=l.pageLayout;formFields=l.formFields;saveLayout();saveFields();};const del=document.createElement("button");del.textContent="Удалить";del.className="danger";del.onclick=()=>{savedLayouts.splice(i,1);localStorage.setItem("layouts",JSON.stringify(savedLayouts));renderLayouts();};row.append(load,del);box.appendChild(row);});}
$("saveLayoutBtn").onclick=()=>{const name=$("layoutName").value.trim();if(!name)return; savedLayouts.push({name,pageLayout,formFields});localStorage.setItem("layouts",JSON.stringify(savedLayouts));renderLayouts();$("layoutName").value="";};

/* Preview */
function renderPreview(){
  const box=$("preview"); box.innerHTML="";
  pageLayout.filter(b=>b.enabled).forEach(b=>{
    const pb=document.createElement("div"); pb.className="preview-block"; pb.innerHTML=`<b>${b.title}</b>`;
    if(b.id==="form"){const form=document.createElement("div");form.className="preview-form";
      formFields.filter(f=>f.enabled).forEach(f=>{
        if(f.type==="textarea"){form.innerHTML+=`<label>${f.label}<br><textarea placeholder="${f.placeholder||""}"></textarea></label>`;}
        else{form.innerHTML+=`<label>${f.label}<br><input type="${f.type}" placeholder="${f.placeholder||""}"></label>`;}
      }); pb.appendChild(form);}
    if(b.id==="filters"){pb.innerHTML+=`<div class="fake-filter"><input placeholder="Цена от"></div><div class="fake-filter"><select><option>Все статусы</option><option>Продажа</option><option>Аренда</option></select></div>`;}
    if(b.id==="map"){const h=b.height||300;pb.innerHTML+=`<div class="fake-map" style="height:${h}px">MAP</div>`;}
    if(b.id==="results"){for(let i=0;i<3;i++){pb.innerHTML+=`<div class="fake-card"><img/><div><div><b>1 ${i+2} 000 000 сум</b></div><div class="mini">Адрес: ул. Пример ${i+1}</div></div></div>`;}}
    box.appendChild(pb);
  });
}

/* Init */
renderBlocks();renderFields();renderLayouts();renderPreview();
</script>
</body>
</html>
