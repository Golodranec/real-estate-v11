<!doctype html>
<html lang="ru">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Admin ‚Äî —Ä—è–¥—ã —Ñ–∏–ª—å—Ç—Ä–æ–≤ + –±–µ—Å–∫–æ–Ω–µ—á–Ω—ã–µ —Å–≤—è–∑–∏</title>
<script src="https://cdn.jsdelivr.net/npm/sortablejs@1.15.0/Sortable.min.js"></script>
<style>
  :root{--bg:#0f1115;--panel:#161a22;--muted:#1f2530;--line:#2a3140;--text:#e6e6e6;--accent:#5b9cff}
  *{box-sizing:border-box}
  body{margin:0;background:var(--bg);color:var(--text);font:14px system-ui}
  header{padding:10px;background:var(--panel);display:flex;gap:10px;align-items:center;flex-wrap:wrap}
  .tabs{display:flex;gap:8px}
  .tab{padding:6px 12px;background:#2a3140;border-radius:6px;cursor:pointer}
  .tab.active{background:var(--accent);color:#fff}
  button{padding:6px 10px;border-radius:6px;border:1px solid transparent;cursor:pointer}
  .btn{background:var(--accent);color:#fff}
  .btn.secondary{background:#2a3140;color:#fff}
  .btn.ghost{background:transparent;border:1px solid #2a3140;color:#e6e6e6}
  input,select,textarea{padding:8px;border-radius:8px;border:1px solid #333;background:#111722;color:#fff}
  main{display:grid;grid-template-columns:1fr 1fr;min-height:92vh}
  .panel{padding:12px;overflow:auto}
  h3{margin:6px 0}
  .row{display:flex;gap:6px;align-items:center;flex-wrap:wrap}
  .item{display:flex;gap:6px;align-items:center;background:var(--muted);border:1px solid var(--line);border-radius:10px;padding:8px;margin:6px 0;flex-wrap:wrap}
  .item .grow{flex:1;min-width:160px}
  .group{border:1px solid var(--line);border-radius:10px;padding:10px;margin:10px 0}
  .group h4{margin:0 0 8px 0;color:#cfd8e3}
  .list{display:flex;flex-wrap:wrap;gap:8px}
  .filter-chip{display:flex;gap:6px;align-items:center;background:#1a202c;border:1px solid #2a3140;border-radius:10px;padding:8px}
  .filter-chip input,.filter-chip select{height:34px}
  /* –º–∞–∫–µ—Ç */
  .canvas{position:relative;display:grid;grid-template-columns:repeat(12,1fr);grid-auto-rows:80px;gap:6px;background:#0b0d12;border:1px dashed #333;padding:6px;min-height:60vh;border-radius:12px}
  .block{background:#1f2530;border:1px solid #2a3140;border-radius:10px;display:flex;align-items:center;justify-content:center;position:relative;user-select:none}
  .block.drag{opacity:.7;outline:1px dashed #8fb2ff}
  .resize{position:absolute;right:0;bottom:0;width:12px;height:12px;background:var(--accent);cursor:se-resize;border-top-left-radius:3px;border-bottom-right-radius:9px}
  .del{position:absolute;top:4px;right:4px;background:#ff4d4d;border:none;color:#fff;border-radius:50%;width:20px;height:20px;cursor:pointer;line-height:18px;font-size:12px}
  /* –ø—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä */
  .preview-grid{display:grid;grid-template-columns:repeat(12,1fr);grid-auto-rows:80px;gap:6px;background:#0b0d12;border:1px solid #2a3140;padding:6px;border-radius:12px}
  .preview-block{background:#1a202c;border:1px solid #2a3140;border-radius:10px;padding:10px;overflow:auto}
  .filters-row{display:flex;gap:10px;flex-wrap:wrap;align-items:end;margin-bottom:10px}
  .field{margin-bottom:8px;min-width:140px}
  .field label{display:block;margin-bottom:4px;font-size:12px;color:#cfd8e3}
  /* –º–æ–¥–∞–ª–∫–∞ */
  .modal{position:fixed;inset:0;background:rgba(0,0,0,.55);display:none;align-items:center;justify-content:center;padding:16px;z-index:50}
  .card{width:min(1000px,96vw);max-height:90vh;overflow:auto;background:#0b0f17;border:1px solid #263042;border-radius:12px;padding:14px}
  textarea{width:100%;min-height:220px;padding:10px;border-radius:8px;border:1px solid #333;background:#0f1522;color:#fff;resize:vertical}
  .hint{color:#9fb3d6;font-size:12px;margin-top:6px}
  /* —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è */
  .notify{position:fixed;top:20px;right:20px;background:#222;color:#fff;padding:10px 16px;border-radius:8px;opacity:0;transition:.3s;z-index:1000}
  .notify.show{opacity:1}
</style>
</head>
<body>
<header>
  <div class="tabs">
    <div class="tab active" data-tab="filters">‚öôÔ∏è –§–∏–ª—å—Ç—Ä—ã –∏ —Ä—è–¥—ã</div>
    <div class="tab" data-tab="fields">üìù –ü–æ–ª—è —Ñ–æ—Ä–º—ã</div>
    <div class="tab" data-tab="layout">üñºÔ∏è –ú–∞–∫–µ—Ç</div>
    <div class="tab" data-tab="preview">üëÄ –ü—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä</div>
  </div>
  <button class="btn secondary" id="exportBtn">–≠–∫—Å–ø–æ—Ä—Ç</button>
  <label class="btn secondary">–ò–º–ø–æ—Ä—Ç<input id="importInput" type="file" hidden></label>
  <button class="btn ghost" id="resetBtn">–°–±—Ä–æ—Å</button>
</header>

<main>
  <!-- ... (—Ñ–∏–ª—å—Ç—Ä—ã, –ø–æ–ª—è –∏ –ø—Ä–æ—á–µ–µ –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π) ... -->
  <section class="panel" id="layoutPanel" style="display:none">
    <h3>–†–µ–¥–∞–∫—Ç–æ—Ä –º–∞–∫–µ—Ç–∞</h3>
    <div class="row" style="margin-bottom:8px">
      <button class="btn" onclick="addBlock('filters')">–§–∏–ª—å—Ç—Ä—ã</button>
      <button class="btn" onclick="addBlock('map')">–ö–∞—Ä—Ç–∞</button>
      <button class="btn" onclick="addBlock('form')">–§–æ—Ä–º–∞</button>
      <button class="btn" onclick="addBlock('cards')">–°–ø–∏—Å–æ–∫</button>
      <button class="btn" onclick="addBlock('table')">–¢–∞–±–ª–∏—Ü–∞</button>
      <button class="btn" onclick="addBlock('banner')">–†–µ–∫–ª–∞–º–∞</button>
    </div>
    <div class="canvas" id="canvas"></div>
  </section>
</main>

<div class="modal" id="modal"><div class="card"><strong id="modalTitle">–†–µ–¥–∞–∫—Ç–æ—Ä</strong><div id="modalBody"></div></div></div>
<div id="notify" class="notify"></div>

<script>
/* ==== —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è ==== */
function notify(msg){
  const box=document.getElementById("notify");
  box.textContent=msg;
  box.classList.add("show");
  setTimeout(()=>box.classList.remove("show"),2000);
}

/* ==== —ç–∫—Å–ø–æ—Ä—Ç/–∏–º–ø–æ—Ä—Ç ==== */
document.getElementById("exportBtn").onclick=()=>{
  const blob=new Blob([JSON.stringify(data,null,2)],{type:"application/json"});
  const url=URL.createObjectURL(blob);
  const a=document.createElement("a"); a.href=url; a.download="admin-config.json"; a.click();
  URL.revokeObjectURL(url);
  notify("‚úÖ –§–∞–π–ª —Å–æ—Ö—Ä–∞–Ω—ë–Ω");
};
document.getElementById("importInput").addEventListener("change",async e=>{
  const f=e.target.files?.[0]; if(!f) return;
  const txt=await f.text(); data=JSON.parse(txt); save();
  notify("‚úÖ –î–∞–Ω–Ω—ã–µ –∑–∞–≥—Ä—É–∂–µ–Ω—ã");
  setTimeout(()=>location.reload(),800);
});

/* ==== –º–∞–∫–µ—Ç ==== */
function renderLayout(){
  canvas.innerHTML="";
  data.layout.forEach(b=>{
    const el=document.createElement("div"); el.className="block";
    el.style.gridColumn=`${b.x}/span ${b.w}`; el.style.gridRow=`${b.y}/span ${b.h}`;
    el.innerHTML=`${labelByType(b.type)}<div class="resize"></div><button class="del" onclick="deleteBlock(${b.id})">‚úñ</button>`;
    // ... (drag & resize –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π)
    canvas.appendChild(el);
  });
}
function deleteBlock(id){
  data.layout=data.layout.filter(b=>b.id!==id);
  save(); renderLayout(); renderPreview();
}
</script>
</body>
</html>
