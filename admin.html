<!doctype html>
<html lang="ru">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Admin Builder v27 Preview (All fields)</title>
<style>
:root{
  --bg:#0b0f16;--panel:#121826;--panel2:#172133;--text:#d7e2f2;--muted:#9fb0c8;
  --border:#273248;--accent:#4aa8ff;--danger:#ef4444;--ok:#22c55e;--warn:#f59e0b;
}
*{box-sizing:border-box}
html,body{height:100%}
body{margin:0;background:var(--bg);color:var(--text);font:14px/1.45 system-ui,Segoe UI,Roboto,Helvetica,Arial}
header{display:flex;align-items:center;gap:8px;padding:10px 12px;border-bottom:1px solid var(--border);background:#0e1420;position:sticky;top:0;z-index:10}
.badge{padding:3px 8px;border-radius:8px;background:#6d28d9;font-weight:700}
.tabs{display:flex;gap:8px;margin-left:8px}
.tab{background:#1a2234;border:1px solid var(--border);padding:6px 10px;border-radius:8px;color:#cfe0ff;cursor:pointer}
.tab.active{background:#2160ff;color:#fff}
main{padding:12px;display:grid;gap:12px}
.panel{background:var(--panel);border:1px solid var(--border);border-radius:12px;padding:12px}
h3{margin:0 0 10px 0;color:#cfe0ff}
.btn{background:#1e293b;border:1px solid var(--border);color:#dbe8ff;padding:6px 10px;border-radius:8px;cursor:pointer}
.btn:hover{border-color:#3a4c6b}
.btn.ok{background:#0f3a1f;border-color:#14532d;color:#c7f9cf}
.btn.warn{background:#3a2a0f;border-color:#7c5a10;color:#fde68a}
.btn.danger{background:#3a0f15;border-color:#7f1d1d;color:#fecaca}
.row{display:flex;gap:8px;align-items:center;flex-wrap:wrap}
.grid{display:grid;gap:10px}
input,select,textarea{padding:8px;border-radius:8px;border:1px solid #31405a;background:#0f1624;color:#e7f1ff;width:100%}
label{display:block;opacity:.9;margin-bottom:6px}
small.muted{color:var(--muted)}
.list{display:grid;gap:10px}
.card{background:var(--panel2);border:1px solid var(--border);border-radius:10px;padding:10px}
.card .title-row{display:flex;gap:8px;align-items:center;justify-content:space-between}
.card h3{margin:0}
.toast{position:fixed;right:12px;bottom:12px;background:#0b1322;border:1px solid #33507a;color:#d7ecff;padding:10px 14px;border-radius:10px;box-shadow:0 8px 24px rgba(0,0,0,.35);opacity:0;transform:translateY(8px);transition:all .25s;z-index:99}
.toast.show{opacity:1;transform:none}
footer{padding:8px 12px;color:#9fb0c8;font-size:12px;border-top:1px solid var(--border)}
.canvas-wrap{border:1px solid var(--border);border-radius:12px;background:#0d121e;padding:6px;overflow:auto;height:62vh}
.canvas,.preview-grid{position:relative;display:grid;grid-template-columns:repeat(12,1fr);grid-auto-rows:90px;gap:6px}
.block,.preview-card{background:#111827;border:1px solid #2b3a5a;border-radius:10px;overflow:hidden;display:flex;flex-direction:column;position:relative}
.block header{display:flex;align-items:center;justify-content:space-between;background:#0f172a;color:#dbe8ff;padding:8px 10px;border-bottom:1px solid #2b3a5a;cursor:grab}
.block header:active{cursor:grabbing}
.block .body{padding:10px;flex:1}
.block .x{background:var(--danger);border:none;color:#fff;border-radius:50%;width:22px;height:22px;line-height:22px;text-align:center;cursor:pointer}
.block .resize{position:absolute;right:6px;bottom:6px;width:14px;height:14px;border-right:3px solid #446; border-bottom:3px solid #446; cursor:nwse-resize;opacity:.8}
.block .title{font-weight:600}
.preview-card{border-color:#3a4c6b}
.p-group{border:1px solid #2a3140;border-radius:10px;padding:12px;margin-bottom:12px;background:#17202c;width:100%}
.p-title{font-size:13px;font-weight:600;margin-bottom:10px;color:#cfe0ff}
.p-row{display:grid;grid-template-columns:repeat(4,1fr);gap:12px;width:100%}
.p-field{min-width:0;width:100%}
.p-field>div{display:flex;gap:8px}
</style>
</head>
<body>
<header>
  <span id="ver" class="badge">v27-preview-allfields</span>
  <div class="tabs">
    <button class="tab active" data-tab="filters">Фильтры</button>
    <button class="tab" data-tab="fields">Поля</button>
    <button class="tab" data-tab="layout">Макет</button>
    <button class="tab" data-tab="preview">Предпросмотр</button>
  </div>
  <div style="margin-left:auto" class="row">
    <button id="btnExport" class="btn">Экспорт</button>
    <label class="btn"><input id="fileImport" type="file" accept=".json,.txt" style="display:none">Импорт</label>
  </div>
</header>

<main>
  <section id="tab-filters" class="panel"></section>
  <section id="tab-fields" class="panel" style="display:none"></section>
  <section id="tab-layout" class="panel" style="display:none"></section>
  <section id="tab-preview" class="panel" style="display:none">
    <div class="canvas-wrap"><div id="preview" class="preview-grid"></div></div>
  </section>
  <div id="toast" class="toast"></div>
</main>

<footer>
  build: admin-full-v27-preview-allfields
</footer>

<script>
// только правка в предпросмотре — все поля показываются
function previewFilters(){
  const wrap=document.createElement('div');
  data.groups.forEach((g,gi)=>{
    const group=document.createElement('div'); group.className='p-group';
    const title=document.createElement('div'); title.className='p-title';
    title.textContent = g.name || (gi===0?'Верхняя линия':'Линия '+(gi+1));
    group.appendChild(title);
    const row=document.createElement('div'); row.className='p-row';
    (g.filters||[]).forEach(name=>{
      const f=byField(name) || {field:name, label:"Без названия", type:"text"};
      const box=document.createElement('div'); box.className='p-field';
      const lab=document.createElement('label'); lab.textContent=f.label || f.field || "Без названия"; box.appendChild(lab);
      if(f.type==='select'){ const sel=document.createElement('select'); (f.options||[]).forEach(o=>{ const opt=document.createElement('option'); opt.textContent=o; sel.appendChild(opt); }); box.appendChild(sel); }
      else if(f.type==='range'){ const div=document.createElement('div'); div.className='row'; div.innerHTML="<input placeholder='от'><input placeholder='до'>"; box.appendChild(div); }
      else if(f.type==='number'){ const num=document.createElement('input'); num.type='number'; box.appendChild(num); }
      else{ const t=document.createElement('input'); t.type='text'; box.appendChild(t); }
      row.appendChild(box);
    });
    group.appendChild(row); wrap.appendChild(group);
  });
  return wrap;
}
</script>
</body>
</html>