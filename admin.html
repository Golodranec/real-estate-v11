<!doctype html>
<html lang="ru">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Admin All-in-One ‚Äî Drag & Resize Grid</title>
<style>
  :root{
    --bg:#0f1115; --panel:#161a22; --muted:#1f2530; --line:#2a3140; --text:#e6e6e6; --accent:#5b9cff;
  }
  *{box-sizing:border-box}
  body{margin:0;background:var(--bg);color:var(--text);font:14px/1.45 system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,"Helvetica Neue",Arial}
  header{padding:10px;background:var(--panel);display:flex;gap:10px;align-items:center;flex-wrap:wrap;border-bottom:1px solid #202634}
  button{padding:6px 12px;border-radius:8px;border:1px solid transparent;cursor:pointer}
  .btn{background:var(--accent);color:#fff}
  .btn.secondary{background:#2a3140;color:#fff}
  .btn.ghost{background:transparent;border-color:#2a3140;color:#d6d6e6}
  .tabs{display:flex;gap:8px}
  .tab{padding:6px 12px;background:#2a3140;border-radius:8px;cursor:pointer}
  .tab.active{background:var(--accent);color:#fff}
  main{display:grid;grid-template-columns:1fr 1fr;min-height:90vh}
  .panel{padding:12px}
  h3{margin:6px 0 10px}
  .row{display:flex;gap:8px;align-items:center;flex-wrap:wrap}
  input,select,textarea{background:#0f131b;border:1px solid #263044;border-radius:8px;padding:8px;color:#e6e6e6}
  .list{display:flex;flex-direction:column;gap:8px}
  .item{display:grid;grid-template-columns:1.2fr 1fr auto;gap:8px;align-items:center;padding:8px;background:#121722;border:1px solid #263044;border-radius:10px}
  .item .del{background:#2a3140}
  .split{display:grid;grid-template-columns:1fr 1fr;gap:12px}
  .canvas-wrap{display:flex;flex-direction:column;gap:8px}
  .grid-help{font-size:12px;color:#9fb0c9}
  .canvas{
    position:relative;
    display:grid;grid-template-columns:repeat(12,1fr);
    grid-auto-rows:80px;gap:6px;
    background:#0b0d12;border:1px dashed #333;padding:6px;min-height:70vh;border-radius:10px;
  }
  .grid-bg{
    position:absolute;inset:6px;pointer-events:none;display:grid;grid-template-columns:repeat(12,1fr);gap:6px;opacity:.25;
  }
  .grid-bg div{border:1px dashed #2a3140;border-radius:6px}
  .block{
    background:var(--muted);border:1px solid var(--line);border-radius:10px;
    display:flex;align-items:center;justify-content:center;position:relative;overflow:hidden;
    user-select:none;
  }
  .block .label{pointer-events:none}
  .block.drag{opacity:.7;outline:1px dashed #8fb2ff}
  .resize{position:absolute;right:0;bottom:0;width:12px;height:12px;cursor:se-resize;background:var(--accent);border-top-left-radius:4px}
  .toolbar{position:absolute;top:4px;right:4px;display:flex;gap:4px}
  .toolbar button{padding:2px 6px;font-size:11px}
  .hint{position:absolute;left:6px;top:4px;font-size:11px;color:#cfe0ff;background:#1b2a46;border:1px solid #2e4a7a;border-radius:999px;padding:2px 6px}
  .preview-surface{background:#0b0d12;border:1px solid #2a3140;padding:10px;border-radius:10px;margin-bottom:10px}
  .field{margin-bottom:6px}
  .field label{font-size:12px;color:#cfd8e6;display:block;margin-bottom:2px}
  .field input,.field select,.field textarea{width:100%;padding:6px;border-radius:6px;border:1px solid #333;background:#111722;color:#fff}
  .card{background:#1a202c;border:1px solid #2a3140;border-radius:10px;padding:10px;margin-bottom:8px}
  .banner{background:#223355;color:#fff;padding:20px;text-align:center;border-radius:8px}
  .gallery{display:grid;grid-template-columns:repeat(3,1fr);gap:6px}
  .gallery div{background:#333;height:60px;border-radius:6px}
  @media (max-width:1100px){ main{grid-template-columns:1fr} }
</style>
</head>
<body>
<header>
  <div class="tabs">
    <div class="tab active" data-tab="content">‚öôÔ∏è –§–∏–ª—å—Ç—Ä—ã –∏ –ø–æ–ª—è</div>
    <div class="tab" data-tab="layout">üñºÔ∏è –ú–∞–∫–µ—Ç</div>
    <div class="tab" data-tab="preview">üëÄ –ü—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä</div>
  </div>
  <div class="row" style="margin-left:auto">
    <button class="btn secondary" id="exportBtn">–≠–∫—Å–ø–æ—Ä—Ç JSON</button>
    <label class="btn secondary">–ò–º–ø–æ—Ä—Ç<input id="importInput" type="file" hidden></label>
    <button class="btn ghost" id="resetBtn">–°–±—Ä–æ—Å</button>
  </div>
</header>

<main>
  <!-- –ö–æ–Ω—Ç–µ–Ω—Ç -->
  <section class="panel" id="contentPanel">
    <h3>–§–∏–ª—å—Ç—Ä—ã</h3>
    <div id="filtersList" class="list"></div>
    <div class="row">
      <input id="filterLabel" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ: –ì–æ—Ä–æ–¥, –¶–µ–Ω–∞..." />
      <input id="filterField" placeholder="field: cityId, price..." />
      <select id="filterType">
        <option value="select">select</option>
        <option value="range">range</option>
        <option value="text">text</option>
      </select>
      <button class="btn" id="addFilterBtn">–î–æ–±–∞–≤–∏—Ç—å</button>
    </div>
    <hr style="border-color:#263044;margin:16px 0">
    <h3>–ü–æ–ª—è —Ñ–æ—Ä–º—ã</h3>
    <div id="fieldsList" class="list"></div>
    <div class="row">
      <input id="fieldLabel" placeholder="–ú–µ—Ç–∫–∞: –ó–∞–≥–æ–ª–æ–≤–æ–∫, –¶–µ–Ω–∞..." />
      <input id="fieldId" placeholder="id: title, price..." />
      <select id="fieldType">
        <option value="text">text</option>
        <option value="number">number</option>
        <option value="select">select</option>
        <option value="textarea">textarea</option>
      </select>
      <button class="btn" id="addFieldBtn">–î–æ–±–∞–≤–∏—Ç—å</button>
    </div>
  </section>

  <!-- –ú–∞–∫–µ—Ç -->
  <section class="panel" id="layoutPanel" style="display:none">
    <h3>–†–µ–¥–∞–∫—Ç–æ—Ä –º–∞–∫–µ—Ç–∞</h3>
    <div class="row" style="margin-bottom:8px">
      <button class="btn" onclick="addBlock('map')">–ö–∞—Ä—Ç–∞</button>
      <button class="btn" onclick="addBlock('filters')">–§–∏–ª—å—Ç—Ä—ã</button>
      <button class="btn" onclick="addBlock('form')">–§–æ—Ä–º–∞</button>
      <button class="btn" onclick="addBlock('cards')">–°–ø–∏—Å–æ–∫</button>
      <button class="btn" onclick="addBlock('table')">–¢–∞–±–ª–∏—Ü–∞</button>
      <button class="btn" onclick="addBlock('banner')">–†–µ–∫–ª–∞–º–∞</button>
      <button class="btn" onclick="addBlock('gallery')">–ì–∞–ª–µ—Ä–µ—è</button>
    </div>
    <div class="canvas-wrap">
      <div class="grid-help">–°–µ—Ç–∫–∞ 12 –∫–æ–ª–æ–Ω–æ–∫. –•–≤–∞—Ç–∞–π –±–ª–æ–∫ –∑–∞ —Ü–µ–Ω—Ç—Ä ‚Äî –ø–µ—Ä–µ—Ç–∞—Å–∫–∏–≤–∞–π. –¢—è–Ω–∏ —É–≥–æ–ª ‚Äî –º–µ–Ω—è–π —Ä–∞–∑–º–µ—Ä. –ò–∑–º–µ–Ω–µ–Ω–∏—è —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏.</div>
      <div id="canvas" class="canvas">
        <div class="grid-bg" aria-hidden="true"></div>
      </div>
    </div>
  </section>

  <!-- –ü—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä -->
  <section class="panel" id="previewPanel" style="display:none">
    <h3>–ü—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä</h3>
    <div id="preview"></div>
  </section>
</main>

<script>
const KEY="admin-all-in-one-v2";
let data = load() || {
  filtersConfig:[
    {label:"–ì–æ—Ä–æ–¥", field:"cityId", type:"select"},
    {label:"–†–∞–π–æ–Ω", field:"districtId", type:"select"},
    {label:"–¶–µ–Ω–∞", field:"price", type:"range"},
    {label:"–ö–æ–º–Ω–∞—Ç—ã", field:"rooms", type:"range"}
  ],
  formFields:[
    {label:"–ó–∞–≥–æ–ª–æ–≤–æ–∫", id:"title", type:"text"},
    {label:"–¶–µ–Ω–∞", id:"price", type:"number"},
    {label:"–ì–æ—Ä–æ–¥", id:"cityId", type:"select"},
    {label:"–†–∞–π–æ–Ω", id:"districtId", type:"select"},
    {label:"–û–ø–∏—Å–∞–Ω–∏–µ", id:"desc", type:"textarea"}
  ],
  layout:[
    {id:1,type:"map",x:1,y:1,w:6,h:3},
    {id:2,type:"filters",x:7,y:1,w:6,h:2},
    {id:3,type:"cards",x:7,y:3,w:6,h:2}
  ]
};

function save(){ localStorage.setItem(KEY, JSON.stringify(data)); }
function load(){ try{ return JSON.parse(localStorage.getItem(KEY)||""); }catch(e){ return null; } }
function reset(){ if(confirm("–°–±—Ä–æ—Å–∏—Ç—å –∫–æ–Ω—Ñ–∏–≥?")){ localStorage.removeItem(KEY); location.reload(); } }

// –≤–∫–ª–∞–¥–∫–∏
document.querySelectorAll(".tab").forEach(tab=>{
  tab.onclick=()=>{
    document.querySelectorAll(".tab").forEach(t=>t.classList.remove("active"));
    tab.classList.add("active");
    const id=tab.dataset.tab;
    document.getElementById("contentPanel").style.display = id==="content"?"block":"none";
    document.getElementById("layoutPanel").style.display  = id==="layout" ?"block":"none";
    document.getElementById("previewPanel").style.display = id==="preview"?"block":"none";
    renderAll();
  }
});

// —ç–∫—Å–ø–æ—Ä—Ç/–∏–º–ø–æ—Ä—Ç/—Å–±—Ä–æ—Å
document.getElementById("exportBtn").onclick=()=>{
  const blob = new Blob([JSON.stringify(data,null,2)], {type:"application/json"});
  const url = URL.createObjectURL(blob); const a=document.createElement("a");
  a.href=url; a.download="admin-config.json"; a.click(); URL.revokeObjectURL(url);
};
document.getElementById("importInput").addEventListener("change", async e=>{
  const f=e.target.files?.[0]; if(!f) return;
  const txt = await f.text();
  try{ data = JSON.parse(txt); save(); renderAll(); }
  catch(err){ alert("–û—à–∏–±–∫–∞ JSON: "+err.message); }
});
document.getElementById("resetBtn").onclick=reset;

// ======== –§–ò–õ–¨–¢–†–´ / –ü–û–õ–Ø =========
function renderFilters(){
  const list = document.getElementById("filtersList");
  list.innerHTML="";
  data.filtersConfig.forEach((f,i)=>{
    const row = document.createElement("div");
    row.className = "item";
    row.innerHTML = `
      <input value="${f.label||""}" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ"/>
      <input value="${f.field||""}" placeholder="field"/>
      <div class="row" style="justify-content:flex-end">
        <select>
          <option value="select" ${f.type==="select"?"selected":""}>select</option>
          <option value="range"  ${f.type==="range" ?"selected":""}>range</option>
          <option value="text"   ${f.type==="text"  ?"selected":""}>text</option>
        </select>
        <button class="del">‚úñ</button>
      </div>
    `;
    const [inLabel,inField] = row.querySelectorAll("input");
    const sel = row.querySelector("select");
    inLabel.oninput = e=>{ f.label=e.target.value; save(); };
    inField.oninput = e=>{ f.field=e.target.value; save(); };
    sel.oninput     = e=>{ f.type=e.target.value; save(); };
    row.querySelector(".del").onclick = ()=>{ data.filtersConfig.splice(i,1); save(); renderFilters(); renderPreview(); };
    list.appendChild(row);
  });
}
function renderFields(){
  const list = document.getElementById("fieldsList");
  list.innerHTML="";
  data.formFields.forEach((f,i)=>{
    const row = document.createElement("div");
    row.className = "item";
    row.innerHTML = `
      <input value="${f.label||""}" placeholder="–ú–µ—Ç–∫–∞"/>
      <input value="${f.id||""}" placeholder="id"/>
      <div class="row" style="justify-content:flex-end">
        <select>
          <option value="text" ${f.type==="text"?"selected":""}>text</option>
          <option value="number" ${f.type==="number"?"selected":""}>number</option>
          <option value="select" ${f.type==="select"?"selected":""}>select</option>
          <option value="textarea" ${f.type==="textarea"?"selected":""}>textarea</option>
        </select>
        <button class="del">‚úñ</button>
      </div>
    `;
    const [inLabel,inId] = row.querySelectorAll("input");
    const sel = row.querySelector("select");
    inLabel.oninput = e=>{ f.label=e.target.value; save(); };
    inId.oninput    = e=>{ f.id=e.target.value; save(); };
    sel.oninput     = e=>{ f.type=e.target.value; save(); };
    row.querySelector(".del").onclick = ()=>{ data.formFields.splice(i,1); save(); renderFields(); renderPreview(); };
    list.appendChild(row);
  });
}
document.getElementById("addFilterBtn").onclick=()=>{
  data.filtersConfig.push({label:"–ù–æ–≤—ã–π —Ñ–∏–ª—å—Ç—Ä", field:"field", type:"select"});
  save(); renderFilters(); renderPreview();
};
document.getElementById("addFieldBtn").onclick=()=>{
  data.formFields.push({label:"–ù–æ–≤–æ–µ –ø–æ–ª–µ", id:"id", type:"text"});
  save(); renderFields(); renderPreview();
};

// ======== –ú–ê–ö–ï–¢: DRAG + RESIZE –ù–ê –°–ï–¢–ö–ï 12 ========
const canvas = document.getElementById("canvas");
const gridBg = canvas.querySelector(".grid-bg");
for(let i=0;i<12;i++){ const c=document.createElement("div"); gridBg.appendChild(c); }

let drag = null; // {block, startX, startY, startGridX, startGridY, offsetX, offsetY}
let resize = null; // {block, startX, startY, startW, startH}
const COLS = 12;

function addBlock(type){
  const id = Date.now();
  data.layout.push({id,type,x:1,y:1,w:6,h:2});
  save(); renderLayout(); renderPreview();
}
function delBlock(id){
  data.layout = data.layout.filter(b=>b.id!==id);
  save(); renderLayout(); renderPreview();
}

function renderLayout(){
  canvas.querySelectorAll(".block").forEach(el=>el.remove());
  data.layout.forEach(b=>{
    const el = document.createElement("div");
    el.className="block";
    el.style.gridColumn = `${b.x}/span ${b.w}`;
    el.style.gridRow    = `${b.y}/span ${b.h}`;
    el.dataset.id = b.id;
    el.innerHTML = `
      <div class="hint">${b.x},${b.y} ¬∑ ${b.w}√ó${b.h}</div>
      <div class="label">${typeName(b.type)}</div>
      <div class="resize"></div>
      <div class="toolbar"><button class="btn ghost" data-del>‚úñ</button></div>
    `;
    // drag start (–ø–æ —Ü–µ–Ω—Ç—Ä—É –±–ª–æ–∫–∞)
    el.addEventListener("mousedown", (e)=>{
      const isResizer = e.target.classList.contains("resize") || e.target.closest(".toolbar");
      if(isResizer) return; // –Ω–µ —Å—Ç–∞—Ä—Ç—É–µ–º –¥—Ä–∞–≥, –µ—Å–ª–∏ –∂–º—ë–º –Ω–∞ —Ä–µ–∑–∞–π–∑–µ—Ä/–∫–Ω–æ–ø–∫–∏
      e.preventDefault();
      const rect = canvas.getBoundingClientRect();
      const cellW = (rect.width - 12*0 + 0) / COLS; // —Ç–æ—á–Ω—ã–π —Ä–∞—Å—Å—á—ë—Ç —à–∏—Ä–∏–Ω—ã –∫–æ–ª–æ–Ω–∫–∏
      const cellH = 80 + 6; // "–≤—ã—Å–æ—Ç–∞ —Å—Ç—Ä–æ–∫–∏ + gap" (–≥—Ä—É–±—ã–π —Å–Ω–∞–ø –ø–æ y)
      drag = {
        block: b,
        startX: e.clientX,
        startY: e.clientY,
        startGridX: b.x,
        startGridY: b.y,
        cellW, cellH
      };
      el.classList.add("drag");
      window.addEventListener("mousemove", onDragMove);
      window.addEventListener("mouseup", onDragEnd);
    });
    // resize
    el.querySelector(".resize").addEventListener("mousedown", (e)=>{
      e.stopPropagation();
      e.preventDefault();
      resize = {
        block:b,
        startX:e.clientX,
        startY:e.clientY,
        startW:b.w,
        startH:b.h
      };
      window.addEventListener("mousemove", onResizeMove);
      window.addEventListener("mouseup", onResizeEnd);
    });
    // delete
    el.querySelector("[data-del]").onclick=()=>delBlock(b.id);
    canvas.appendChild(el);
  });
}

function onDragMove(e){
  if(!drag) return;
  const {block, startX, startY, startGridX, startGridY, cellW, cellH} = drag;
  const dx = e.clientX - startX;
  const dy = e.clientY - startY;

  // –ø–µ—Ä–µ—Å—á—ë—Ç –≤ –∫–ª–µ—Ç–∫–∏
  let newX = startGridX + Math.round(dx / cellW);
  let newY = startGridY + Math.round(dy / (cellH)); // —à–∞–≥ –ø–æ —Å—Ç—Ä–æ–∫–∞–º

  // –≥—Ä–∞–Ω–∏—Ü—ã
  newX = Math.max(1, Math.min(COLS - block.w + 1, newX));
  newY = Math.max(1, newY);

  block.x = newX;
  block.y = newY;
  save();
  renderLayout(); // –ø–µ—Ä–µ—Ä–∏—Å–æ–≤—ã–≤–∞–µ–º, —á—Ç–æ–±—ã –±–ª–æ–∫ –ø—Ä—ã–≥–∞–ª –ø–æ —Å–µ—Ç–∫–µ
}
function onDragEnd(){
  const active = canvas.querySelector(".block.drag");
  if(active) active.classList.remove("drag");
  window.removeEventListener("mousemove", onDragMove);
  window.removeEventListener("mouseup", onDragEnd);
  drag = null;
}

function onResizeMove(e){
  if(!resize) return;
  const {block, startX, startY, startW, startH} = resize;
  const rect = canvas.getBoundingClientRect();
  const cellW = rect.width / COLS;
  const dx = e.clientX - startX;
  const dy = e.clientY - startY;

  let w = startW + Math.round(dx / cellW);
  let h = startH + Math.round(dy / 80); // 80px ‚Äî –±–∞–∑–æ–≤–∞—è –≤—ã—Å–æ—Ç–∞ —Å—Ç—Ä–æ–∫–∏

  w = Math.max(1, Math.min(COLS - block.x + 1, w));
  h = Math.max(1, h);

  block.w = w;
  block.h = h;
  save();
  renderLayout();
}
function onResizeEnd(){
  window.removeEventListener("mousemove", onResizeMove);
  window.removeEventListener("mouseup", onResizeEnd);
  resize = null;
}

function typeName(t){
  return ({
    map:"üó∫Ô∏è –ö–∞—Ä—Ç–∞",
    filters:"üîé –§–∏–ª—å—Ç—Ä—ã",
    form:"üìù –§–æ—Ä–º–∞",
    cards:"üìã –°–ø–∏—Å–æ–∫",
    table:"üìä –¢–∞–±–ª–∏—Ü–∞",
    banner:"üì∞ –†–µ–∫–ª–∞–º–∞",
    gallery:"üñºÔ∏è –ì–∞–ª–µ—Ä–µ—è"
  })[t] || t;
}

// ======== –ü–†–ï–î–ü–†–û–°–ú–û–¢–† =========
function renderPreview(){
  const wrap = document.getElementById("preview");
  wrap.innerHTML = "";
  // —Ä–∏—Å—É–µ–º –≤ –ø–æ—Ä—è–¥–∫–µ –ø–æ Y, –ø–æ—Ç–æ–º –ø–æ X (—á—Ç–æ–±—ã –≤–∏–∑—É–∞–ª—å–Ω–æ –±—ã–ª–æ –±–ª–∏–∂–µ –∫ –º–∞–∫–µ—Ç—É)
  const sorted = [...data.layout].sort((a,b)=> a.y===b.y ? a.x-b.x : a.y-b.y);

  sorted.forEach(b=>{
    const pv = document.createElement("div");
    pv.className = "preview-surface";
    if(b.type==="map"){
      pv.innerHTML = "<div style='background:#223;height:240px;border-radius:8px;display:flex;align-items:center;justify-content:center'>üó∫Ô∏è –ö–∞—Ä—Ç–∞</div>";
    }else if(b.type==="filters"){
      pv.innerHTML = "<h4 style='margin:0 0 6px'>–§–∏–ª—å—Ç—Ä—ã</h4>";
      (data.filtersConfig||[]).forEach(f=>{
        pv.innerHTML += `<div class="field"><label>${f.label||f.field}</label>${
          f.type==="select" ? `<select><option>‚Äî</option></select>` :
          f.type==="range"  ? `<div class="row"><input type="number" placeholder="–æ—Ç"><input type="number" placeholder="–¥–æ"></div>` :
                              `<input type="text" placeholder="${f.field}">`
        }</div>`;
      });
    }else if(b.type==="form"){
      pv.innerHTML = "<h4 style='margin:0 0 6px'>–§–æ—Ä–º–∞</h4>";
      (data.formFields||[]).forEach(ff=>{
        pv.innerHTML += `<div class="field"><label>${ff.label||ff.id}</label>${
          ff.type==="textarea" ? `<textarea rows="3" placeholder="${ff.id}"></textarea>` :
          ff.type==="select"   ? `<select><option>‚Äî</option></select>` :
          ff.type==="number"   ? `<input type="number" placeholder="${ff.id}">` :
                                 `<input type="text" placeholder="${ff.id}">`
        }</div>`;
      });
    }else if(b.type==="cards"){
      pv.innerHTML = `<h4 style='margin:0 0 6px'>–°–ø–∏—Å–æ–∫</h4>
        <div class="card">–û–±—ä—è–≤–ª–µ–Ω–∏–µ 1 ‚Ä¢ 78 000 —É.–µ.</div>
        <div class="card">–û–±—ä—è–≤–ª–µ–Ω–∏–µ 2 ‚Ä¢ 2 500 000 —Å—É–º/–º–µ—Å</div>`;
    }else if(b.type==="table"){
      pv.innerHTML = "<h4 style='margin:0 0 6px'>–¢–∞–±–ª–∏—Ü–∞</h4><table border=1 width=100% style='border-collapse:collapse'><tr><th>ID</th><th>–ó–∞–≥–æ–ª–æ–≤–æ–∫</th><th>–¶–µ–Ω–∞</th></tr><tr><td>1</td><td>–ö–≤–∞—Ä—Ç–∏—Ä–∞</td><td>78 000</td></tr></table>";
    }else if(b.type==="banner"){
      pv.innerHTML = "<div class='banner'>–†–µ–∫–ª–∞–º–Ω—ã–π –±–ª–æ–∫</div>";
    }else if(b.type==="gallery"){
      pv.innerHTML = "<div class='gallery'><div></div><div></div><div></div></div>";
    }
    wrap.appendChild(pv);
  });
}

// ======== –†–ï–ù–î–ï–† –í–°–Å =========
function renderAll(){
  renderFilters();
  renderFields();
  renderLayout();
  renderPreview();
}
renderAll();
</script>
</body>
</html>
